"use strict";(self.webpackChunkpodman=self.webpackChunkpodman||[]).push([[9360],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=d(e.components);return o.createElement(l.Provider,{value:n},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=d(t),c=a,h=p["".concat(l,".").concat(c)]||p[c]||m[c]||i;return t?o.createElement(h,r(r({ref:n},u),{},{components:t})):o.createElement(h,r({ref:n},u))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=c;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:a,r[1]=s;for(var d=2;d<i;d++)r[d]=t[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},9222:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var o=t(7462),a=(t(7294),t(3905));const i={},r=void 0,s={unversionedId:"troubleshooting",id:"troubleshooting",title:"troubleshooting",description:"PODMAN logo",source:"@site/docs/troubleshooting.md",sourceDirName:".",slug:"/troubleshooting",permalink:"/website-new/docs/troubleshooting",draft:!1,editUrl:"https://github.com/containers/website-new/docs/troubleshooting.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Podman",permalink:"/website-new/docs/podman"},next:{title:"Tutorials",permalink:"/website-new/docs/tutorials/"}},l={},d=[{value:"A list of common issues and solutions for Podman",id:"a-list-of-common-issues-and-solutions-for-podman",level:2},{value:"1) Variety of issues - Validate Version",id:"1-variety-of-issues---validate-version",level:3},{value:"2) Can&#39;t use volume mount, get permission denied",id:"2-cant-use-volume-mount-get-permission-denied",level:3},{value:"Solution",id:"solution",level:4},{value:"3) No such image or Bare keys cannot contain &#39;:&#39;",id:"3-no-such-image-or-bare-keys-cannot-contain-",level:3},{value:"Symptom",id:"symptom",level:4},{value:"Solution",id:"solution-1",level:4},{value:"4) http: server gave HTTP response to HTTPS client",id:"4-http-server-gave-http-response-to-https-client",level:3},{value:"Symptom",id:"symptom-1",level:4},{value:"Solution",id:"solution-2",level:4},{value:"5) rootless containers cannot ping hosts",id:"5-rootless-containers-cannot-ping-hosts",level:3},{value:"Symptom",id:"symptom-2",level:4},{value:"Solution",id:"solution-3",level:4},{value:"6) Build hangs when the Dockerfile contains the useradd command",id:"6-build-hangs-when-the-dockerfile-contains-the-useradd-command",level:3},{value:"Symptom",id:"symptom-3",level:4},{value:"Solution",id:"solution-4",level:4},{value:"7) Permission denied when running Podman commands",id:"7-permission-denied-when-running-podman-commands",level:3},{value:"Symptom",id:"symptom-4",level:4},{value:"Solution",id:"solution-5",level:4},{value:"8) Permission denied when running systemd within a Podman container",id:"8-permission-denied-when-running-systemd-within-a-podman-container",level:3},{value:"Symptom",id:"symptom-5",level:4},{value:"Solution",id:"solution-6",level:4},{value:"9) Newuidmap missing when running rootless Podman commands",id:"9-newuidmap-missing-when-running-rootless-podman-commands",level:3},{value:"Symptom",id:"symptom-6",level:4},{value:"Solution",id:"solution-7",level:4},{value:"10) rootless setup user: invalid argument",id:"10-rootless-setup-user-invalid-argument",level:3},{value:"Symptom",id:"symptom-7",level:4},{value:"Solution",id:"solution-8",level:4},{value:"11) Changing the location of the Graphroot leads to permission denied",id:"11-changing-the-location-of-the-graphroot-leads-to-permission-denied",level:3},{value:"Symptom",id:"symptom-8",level:4},{value:"Solution",id:"solution-9",level:4},{value:"12) Anonymous image pull fails with &#39;invalid username/password&#39;",id:"12-anonymous-image-pull-fails-with-invalid-usernamepassword",level:3},{value:"Symptom",id:"symptom-9",level:4},{value:"Solution",id:"solution-10",level:4},{value:"13) Running Podman inside a container causes container crashes and inconsistent states",id:"13-running-podman-inside-a-container-causes-container-crashes-and-inconsistent-states",level:3},{value:"Symptom",id:"symptom-10",level:4},{value:"Solution",id:"solution-11",level:4},{value:"14) Rootless &#39;podman build&#39; fails EPERM on NFS:",id:"14-rootless-podman-build-fails-eperm-on-nfs",level:3},{value:"Symptom",id:"symptom-11",level:4},{value:"Solution",id:"solution-12",level:4},{value:"15) Rootless &#39;podman build&#39; fails when using OverlayFS:",id:"15-rootless-podman-build-fails-when-using-overlayfs",level:3},{value:"Symptom",id:"symptom-12",level:4},{value:"Solution",id:"solution-13",level:4},{value:"16) RHEL 7 and CentOS 7 based <code>init</code> images don&#39;t work with cgroup v2",id:"16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2",level:3},{value:"Symptom",id:"symptom-13",level:4},{value:"Solution",id:"solution-14",level:4},{value:"17) rootless containers exit once the user session exits",id:"17-rootless-containers-exit-once-the-user-session-exits",level:3},{value:"Symptom",id:"symptom-14",level:4},{value:"Solution",id:"solution-15",level:4},{value:"18) <code>podman run</code> fails with &quot;bpf create: permission denied error&quot;",id:"18-podman-run-fails-with-bpf-create-permission-denied-error",level:3},{value:"Symptom",id:"symptom-15",level:4},{value:"Solution",id:"solution-16",level:4},{value:"19) error creating libpod runtime: there might not be enough IDs available in the namespace",id:"19-error-creating-libpod-runtime-there-might-not-be-enough-ids-available-in-the-namespace",level:3},{value:"Symptom",id:"symptom-16",level:4},{value:"Solution",id:"solution-17",level:4},{value:"20) Passed-in devices or files can&#39;t be accessed in rootless container",id:"20-passed-in-devices-or-files-cant-be-accessed-in-rootless-container",level:3},{value:"Symptom",id:"symptom-17",level:4},{value:"Solution",id:"solution-18",level:4},{value:"21) A rootless container running in detached mode is closed at logout",id:"21-a-rootless-container-running-in-detached-mode-is-closed-at-logout",level:3},{value:"Symptom",id:"symptom-18",level:4},{value:"Solution",id:"solution-19",level:4},{value:"22) Containers default detach keys conflict with shell history navigation",id:"22-containers-default-detach-keys-conflict-with-shell-history-navigation",level:3},{value:"Symptom",id:"symptom-19",level:4},{value:"Solution",id:"solution-20",level:4},{value:"23) Container with exposed ports won&#39;t run in a pod",id:"23-container-with-exposed-ports-wont-run-in-a-pod",level:3},{value:"Symptom",id:"symptom-20",level:4},{value:"Solution",id:"solution-21",level:4},{value:"24) Podman container images fail with <code>fuse: device not found</code> when run",id:"24-podman-container-images-fail-with-fuse-device-not-found-when-run",level:3},{value:"Symptom",id:"symptom-21",level:4},{value:"Solution",id:"solution-22",level:4},{value:"25) podman run --rootfs link/to//read/only/dir does not work",id:"25-podman-run---rootfs-linktoreadonlydir-does-not-work",level:3},{value:"Symptom",id:"symptom-22",level:4},{value:"Solution",id:"solution-23",level:4},{value:"26) Running containers with resource limits fails with a permissions error",id:"26-running-containers-with-resource-limits-fails-with-a-permissions-error",level:3},{value:"Symptom",id:"symptom-23",level:4},{value:"Solution",id:"solution-24",level:4},{value:"27) <code>exec container process &#39;/bin/sh&#39;: Exec format error</code> (or another binary than <code>bin/sh</code>)",id:"27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh",level:3},{value:"28) <code>Error: failed to create sshClient: Connection to bastion host (ssh://user@host:22/run/user/.../podman/podman.sock) failed.: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain</code>",id:"28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain",level:3},{value:"Symptom",id:"symptom-24",level:4},{value:"Solution",id:"solution-25",level:4},{value:"29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1.",id:"29-rootless-cni-networking-fails-in-rhel-with-podman-v221-to-v301",level:3},{value:"Symptom",id:"symptom-25",level:4},{value:"Solution",id:"solution-26",level:4},{value:"30) Container related firewall rules are lost after reloading firewalld",id:"30-container-related-firewall-rules-are-lost-after-reloading-firewalld",level:3},{value:"Symptom",id:"symptom-26",level:4},{value:"Solution",id:"solution-27",level:4},{value:"31) Podman run fails with <code>ERRO[0000] XDG_RUNTIME_DIR directory &quot;/run/user/0&quot; is not owned by the current user</code> or <code>Error: creating tmpdir: mkdir /run/user/1000: permission denied</code>.",id:"31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied",level:3},{value:"Symptom",id:"symptom-27",level:4},{value:"Solution",id:"solution-28",level:4},{value:"32) 127.0.0.1:7777 port already bound",id:"32-1270017777-port-already-bound",level:3},{value:"Symptom",id:"symptom-28",level:4},{value:"Solution",id:"solution-29",level:4},{value:"33) The sshd process fails to run inside of the container.",id:"33-the-sshd-process-fails-to-run-inside-of-the-container",level:3},{value:"Symptom",id:"symptom-29",level:4},{value:"Solution",id:"solution-30",level:3},{value:"34) Container creates a file that is not owned by the user&#39;s regular UID",id:"34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid",level:3},{value:"Symptom",id:"symptom-30",level:4},{value:"Solution",id:"solution-31",level:4},{value:"35) Passed-in devices or files can&#39;t be accessed in rootless container (UID/GID mapping problem)",id:"35-passed-in-devices-or-files-cant-be-accessed-in-rootless-container-uidgid-mapping-problem",level:3},{value:"Symptom",id:"symptom-31",level:4},{value:"Solution",id:"solution-32",level:4},{value:"36) Images in the additional stores can be deleted even if there are containers using them",id:"36-images-in-the-additional-stores-can-be-deleted-even-if-there-are-containers-using-them",level:3},{value:"Symptom",id:"symptom-32",level:4},{value:"Solution",id:"solution-33",level:4},{value:"37) Syncing bugfixes for podman-remote or setups using Podman API",id:"37-syncing-bugfixes-for-podman-remote-or-setups-using-podman-api",level:3},{value:"Symptom",id:"symptom-33",level:4},{value:"Solution",id:"solution-34",level:4},{value:"38) Unexpected carriage returns are outputted on the terminal",id:"38-unexpected-carriage-returns-are-outputted-on-the-terminal",level:3},{value:"Symptom",id:"symptom-34",level:4},{value:"Solution",id:"solution-35",level:4},{value:"39) Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;",id:"39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed",level:3},{value:"Symptom",id:"symptom-35",level:4},{value:"Solution",id:"solution-36",level:4},{value:"40) Podman fails to find expected image with &quot;error locating pulled image&quot;, &quot;image not known&quot;",id:"40-podman-fails-to-find-expected-image-with-error-locating-pulled-image-image-not-known",level:3},{value:"Symptom",id:"symptom-36",level:4},{value:"Solution",id:"solution-37",level:4}],u={toc:d},p="wrapper";function m(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/containers/common/main/logos/podman-logo-full-vert.png",alt:"PODMAN logo"})),(0,a.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("h2",{id:"a-list-of-common-issues-and-solutions-for-podman"},"A list of common issues and solutions for Podman"),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"1-variety-of-issues---validate-version"},"1) Variety of issues - Validate Version"),(0,a.kt)("p",null,"A large number of issues reported against Podman are often found to already be fixed\nin more current versions of the project. Before reporting an issue, please verify the\nversion you are running with ",(0,a.kt)("inlineCode",{parentName:"p"},"podman version")," and compare it to the latest release\ndocumented on the top of Podman's ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/blob/main/README.md"},"README"),"."),(0,a.kt)("p",null,"If they differ, please update your version of PODMAN to the latest possible\nand retry your command before reporting the issue."),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"2-cant-use-volume-mount-get-permission-denied"},"2) Can't use volume mount, get permission denied"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run -v ~/mycontent:/content fedora touch /content/file\ntouch: cannot touch '/content/file': Permission denied\n")),(0,a.kt)("h4",{id:"solution"},"Solution"),(0,a.kt)("p",null,"This is sometimes caused by SELinux, and sometimes by user namespaces."),(0,a.kt)("p",null,"Labeling systems like SELinux require that proper labels are placed on volume\ncontent mounted into a container. Without a label, the security system might\nprevent the processes running inside the container from using the content. By\ndefault, Podman does not change the labels set by the OS."),(0,a.kt)("p",null,"To change a label in the container context, you can add either of two suffixes\n",(0,a.kt)("strong",{parentName:"p"},":z")," or ",(0,a.kt)("strong",{parentName:"p"},":Z")," to the volume mount. These suffixes tell Podman to relabel file\nobjects on the shared volumes. The ",(0,a.kt)("strong",{parentName:"p"},"z")," option tells Podman that two containers\nshare the volume content. As a result, Podman labels the content with a shared\ncontent label. Shared volume labels allow all containers to read/write content.\nThe ",(0,a.kt)("strong",{parentName:"p"},"Z")," option tells Podman to label the content with a private unshared label.\nOnly the current container can use a private volume."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run -v ~/mycontent:/content:Z fedora touch /content/file\n")),(0,a.kt)("p",null,"Make sure the content is private for the container. Do not relabel system directories and content.\nRelabeling system content might cause other confined services on your machine to fail. For these\ntypes of containers we recommend having SELinux separation disabled. The option ",(0,a.kt)("inlineCode",{parentName:"p"},"--security-opt label=disable"),"\nwill disable SELinux separation for the container."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run --security-opt label=disable -v ~:/home/user fedora touch /home/user/file\n")),(0,a.kt)("p",null,'In cases where the container image runs as a specific, non-root user, though, the\nsolution is to fix the user namespace. This would include container images such as\nthe Jupyter Notebook image (which runs as "jovyan") and the Postgres image (which runs\nas "postgres"). In either case, use the ',(0,a.kt)("inlineCode",{parentName:"p"},"--userns")," switch to map user namespaces,\nmost of the time by using the ",(0,a.kt)("strong",{parentName:"p"},"keep-id")," option."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman run -v "$PWD":/home/jovyan/work --userns=keep-id jupyter/scipy-notebook\n')),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"3-no-such-image-or-bare-keys-cannot-contain-"},"3) No such image or Bare keys cannot contain ':'"),(0,a.kt)("p",null,"When doing a ",(0,a.kt)("inlineCode",{parentName:"p"},"podman pull")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"podman build"),' command and a "common" image cannot be pulled,\nit is likely that the ',(0,a.kt)("inlineCode",{parentName:"p"},"/etc/containers/registries.conf")," file is either not installed or possibly\nmisconfigured."),(0,a.kt)("h4",{id:"symptom"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ sudo podman build -f Dockerfile\nSTEP 1: FROM alpine\nerror building: error creating build container: no such image "alpine" in registry: image not known\n')),(0,a.kt)("p",null,"or"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ sudo podman pull fedora\nerror pulling image \"fedora\": unable to pull fedora: error getting default registries to try: Near line 9 (last key parsed ''): Bare keys cannot contain ':'.\n")),(0,a.kt)("h4",{id:"solution-1"},"Solution"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Verify that the ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/containers/registries.conf")," file exists. If not, verify that the containers-common package is installed."),(0,a.kt)("li",{parentName:"ul"},"Verify that the entries in the ",(0,a.kt)("inlineCode",{parentName:"li"},"unqualified-search-registries")," list of the ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/containers/registries.conf")," file are valid and reachable.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"i.e. ",(0,a.kt)("inlineCode",{parentName:"li"},'unqualified-search-registries = ["registry.fedoraproject.org", "quay.io", "registry.access.redhat.com"]'))))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"4-http-server-gave-http-response-to-https-client"},"4) http: server gave HTTP response to HTTPS client"),(0,a.kt)("p",null,"When doing a Podman command such as ",(0,a.kt)("inlineCode",{parentName:"p"},"build"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"commit"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"pull"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"push")," to a registry,\nTLS verification is turned on by default. If encryption is not used with\nthose commands, this error can occur."),(0,a.kt)("h4",{id:"symptom-1"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ sudo podman push alpine docker://localhost:5000/myalpine:latest\nGetting image source signatures\nGet https://localhost:5000/v2/: http: server gave HTTP response to HTTPS client\n")),(0,a.kt)("h4",{id:"solution-2"},"Solution"),(0,a.kt)("p",null,"By default TLS verification is turned on when communicating to registries from\nPodman. If the registry does not require encryption the Podman commands\nsuch as ",(0,a.kt)("inlineCode",{parentName:"p"},"build"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"commit"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"pull")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"push")," will fail unless TLS verification is turned\noff using the ",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-verify")," option. ",(0,a.kt)("strong",{parentName:"p"},"NOTE:")," It is not at all recommended to\ncommunicate with a registry and not use TLS verification."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Turn off TLS verification by passing false to the tls-verify option."),(0,a.kt)("li",{parentName:"ul"},"I.e. ",(0,a.kt)("inlineCode",{parentName:"li"},"podman push --tls-verify=false alpine docker://localhost:5000/myalpine:latest"))),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"5-rootless-containers-cannot-ping-hosts"},"5) rootless containers cannot ping hosts"),(0,a.kt)("p",null,"When using the ping command from a non-root container, the command may\nfail because of a lack of privileges."),(0,a.kt)("h4",{id:"symptom-2"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run --rm fedora ping -W10 -c1 redhat.com\nPING redhat.com (209.132.183.105): 56 data bytes\n\n--- redhat.com ping statistics ---\n1 packets transmitted, 0 packets received, 100% packet loss\n")),(0,a.kt)("h4",{id:"solution-3"},"Solution"),(0,a.kt)("p",null,"It is most likely necessary to enable unprivileged pings on the host.\nBe sure the UID of the user is part of the range in the\n",(0,a.kt)("inlineCode",{parentName:"p"},"/proc/sys/net/ipv4/ping_group_range")," file."),(0,a.kt)("p",null,"To change its value you can use something like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'# sysctl -w "net.ipv4.ping_group_range=0 2000000"\n')),(0,a.kt)("p",null,"To make the change persistent, you'll need to add a file in\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.d")," that contains ",(0,a.kt)("inlineCode",{parentName:"p"},"net.ipv4.ping_group_range=0 $MAX_UID"),"."),(0,a.kt)("hr",null),(0,a.kt)("h3",{id:"6-build-hangs-when-the-dockerfile-contains-the-useradd-command"},"6) Build hangs when the Dockerfile contains the useradd command"),(0,a.kt)("p",null,"When the Dockerfile contains a command like ",(0,a.kt)("inlineCode",{parentName:"p"},"RUN useradd -u 99999000 -g users newuser")," the build can hang."),(0,a.kt)("h4",{id:"symptom-3"},"Symptom"),(0,a.kt)("p",null,"If you are using a useradd command within a Dockerfile with a large UID/GID, it will create a large sparse file ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/log/lastlog"),". This can cause the build to hang forever. Go language does not support sparse files correctly, which can lead to some huge files being created in your container image."),(0,a.kt)("h4",{id:"solution-4"},"Solution"),(0,a.kt)("p",null,"If the entry in the Dockerfile looked like: RUN useradd -u 99999000 -g users newuser then add the ",(0,a.kt)("inlineCode",{parentName:"p"},"--no-log-init")," parameter to change it to: ",(0,a.kt)("inlineCode",{parentName:"p"},"RUN useradd --no-log-init -u 99999000 -g users newuser"),". This option tells useradd to stop creating the lastlog file."),(0,a.kt)("h3",{id:"7-permission-denied-when-running-podman-commands"},"7) Permission denied when running Podman commands"),(0,a.kt)("p",null,"When rootless Podman attempts to execute a container on a non exec home directory a permission error will be raised."),(0,a.kt)("h4",{id:"symptom-4"},"Symptom"),(0,a.kt)("p",null,"If you are running Podman or Buildah on a home directory that is mounted noexec,\nthen they will fail with a message like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman run centos:7\nstandard_init_linux.go:203: exec user process caused "permission denied"\n')),(0,a.kt)("h4",{id:"solution-5"},"Solution"),(0,a.kt)("p",null,"Since the administrator of the system set up your home directory to be noexec, you will not be allowed to execute containers from storage in your home directory. It is possible to work around this by manually specifying a container storage path that is not on a noexec mount. Simply copy the file /etc/containers/storage.conf to ~/.config/containers/ (creating the directory if necessary). Specify a graphroot directory which is not on a noexec mount point and to which you have read/write privileges. You will need to modify other fields to writable directories as well."),(0,a.kt)("p",null,"For example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ cat ~/.config/containers/storage.conf\n[storage]\n  driver = "overlay"\n  runroot = "/run/user/1000"\n  graphroot = "/execdir/myuser/storage"\n  [storage.options]\n    mount_program = "/bin/fuse-overlayfs"\n')),(0,a.kt)("h3",{id:"8-permission-denied-when-running-systemd-within-a-podman-container"},"8) Permission denied when running systemd within a Podman container"),(0,a.kt)("p",null,"When running systemd as PID 1 inside of a container on an SELinux\nseparated machine, it needs to write to the cgroup file system."),(0,a.kt)("h4",{id:"symptom-5"},"Symptom"),(0,a.kt)("p",null,"Systemd gets permission denied when attempting to write to the cgroup file\nsystem, and AVC messages start to show up in the audit.log file or journal on\nthe system."),(0,a.kt)("h4",{id:"solution-6"},"Solution"),(0,a.kt)("p",null,"Newer versions of Podman (2.0 or greater) support running init based containers\nwith a different SELinux labels, which allow the container process access to the\ncgroup file system. This feature requires container-selinux-2.132 or newer\nversions."),(0,a.kt)("p",null,"Prior to Podman 2.0, the SELinux boolean ",(0,a.kt)("inlineCode",{parentName:"p"},"container_manage_cgroup")," allows\ncontainer processes to write to the cgroup file system. Turn on this boolean,\non SELinux separated systems, to allow systemd to run properly in the container.\nOnly do this on systems running older versions of Podman."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# setsebool -P container_manage_cgroup true\n")),(0,a.kt)("h3",{id:"9-newuidmap-missing-when-running-rootless-podman-commands"},"9) Newuidmap missing when running rootless Podman commands"),(0,a.kt)("p",null,"Rootless Podman requires the newuidmap and newgidmap programs to be installed."),(0,a.kt)("h4",{id:"symptom-6"},"Symptom"),(0,a.kt)("p",null,"If you are running Podman or Buildah as a rootless user, you get an error complaining about\na missing newuidmap executable."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman run -ti fedora sh\ncommand required for rootless mode with multiple IDs: exec: "newuidmap": executable file not found in $PATH\n')),(0,a.kt)("h4",{id:"solution-7"},"Solution"),(0,a.kt)("p",null,"Install a version of shadow-utils that includes these executables. Note that for RHEL and CentOS 7, at least the 7.7 release must be installed for support to be available."),(0,a.kt)("h3",{id:"10-rootless-setup-user-invalid-argument"},"10) rootless setup user: invalid argument"),(0,a.kt)("p",null,"Rootless Podman requires the user running it to have a range of UIDs listed in /etc/subuid and /etc/subgid."),(0,a.kt)("h4",{id:"symptom-7"},"Symptom"),(0,a.kt)("p",null,"A user, either via --user or through the default configured for the image, is not mapped inside the namespace."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman run --rm -ti --user 1000000 alpine echo hi\nError: container create failed: container_linux.go:344: starting container process caused "setup user: invalid argument"\n')),(0,a.kt)("h4",{id:"solution-8"},"Solution"),(0,a.kt)("p",null,"Update the /etc/subuid and /etc/subgid with fields for users that look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ cat /etc/subuid\njohndoe:100000:65536\ntest:165536:65536\n")),(0,a.kt)("p",null,"The format of this file is ",(0,a.kt)("inlineCode",{parentName:"p"},"USERNAME:UID:RANGE")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"username as listed in ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/passwd")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"getpwent"),"."),(0,a.kt)("li",{parentName:"ul"},"The initial uid allocated for the user."),(0,a.kt)("li",{parentName:"ul"},"The size of the range of UIDs allocated for the user.")),(0,a.kt)("p",null,"This means johndoe is allocated UIDs 100000-165535 as well as his standard UID in the\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," file."),(0,a.kt)("p",null,"You should ensure that each user has a unique range of UIDs, because overlapping UIDs,\nwould potentially allow one user to attack another user. In addition, make sure\nthat the range of UIDs you allocate can cover all UIDs that the container\nrequires. For example, if the container has a user with UID 10000, ensure you\nhave at least 10001 subuids, and if the container needs to be run as a user with\nUID 1000000, ensure you have at least 1000001 subuids."),(0,a.kt)("p",null,"You could also use the ",(0,a.kt)("inlineCode",{parentName:"p"},"usermod")," program to assign UIDs to a user."),(0,a.kt)("p",null,"If you update either the ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/subuid")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/subgid")," file, you need to\nstop all running containers and kill the pause process. This is done\nautomatically by the ",(0,a.kt)("inlineCode",{parentName:"p"},"system migrate")," command, which can also be used\nto stop all the containers and kill the pause process."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# usermod --add-subuids 200000-201000 --add-subgids 200000-201000 johndoe\n# grep johndoe /etc/subuid /etc/subgid\n/etc/subuid:johndoe:200000:1001\n/etc/subgid:johndoe:200000:1001\n")),(0,a.kt)("h3",{id:"11-changing-the-location-of-the-graphroot-leads-to-permission-denied"},"11) Changing the location of the Graphroot leads to permission denied"),(0,a.kt)("p",null,"When I change the graphroot storage location in storage.conf, the next time I\nrun Podman, I get an error like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# podman run -p 5000:5000 -it centos bash\n\nbash: error while loading shared libraries: /lib64/libc.so.6: cannot apply additional memory protection after relocation: Permission denied\n")),(0,a.kt)("p",null,"For example, the admin sets up a spare disk to be mounted at ",(0,a.kt)("inlineCode",{parentName:"p"},"/src/containers"),",\nand points storage.conf at this directory."),(0,a.kt)("h4",{id:"symptom-8"},"Symptom"),(0,a.kt)("p",null,"SELinux blocks containers from using arbitrary locations for overlay storage.\nThese directories need to be labeled with the same labels as if the content was\nunder ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/containers/storage"),"."),(0,a.kt)("h4",{id:"solution-9"},"Solution"),(0,a.kt)("p",null,"Tell SELinux about the new containers storage by setting up an equivalence record.\nThis tells SELinux to label content under the new path, as if it was stored\nunder ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/containers/storage"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# semanage fcontext -a -e /var/lib/containers /srv/containers\n# restorecon -R -v /srv/containers\n")),(0,a.kt)("p",null,"The semanage command above tells SELinux to set up the default labeling of\n",(0,a.kt)("inlineCode",{parentName:"p"},"/srv/containers")," to match ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/containers"),". The ",(0,a.kt)("inlineCode",{parentName:"p"},"restorecon")," command\ntells SELinux to apply the labels to the actual content."),(0,a.kt)("p",null,"Now all new content created in these directories will automatically be created\nwith the correct label."),(0,a.kt)("h3",{id:"12-anonymous-image-pull-fails-with-invalid-usernamepassword"},"12) Anonymous image pull fails with 'invalid username/password'"),(0,a.kt)("p",null,"Pulling an anonymous image that doesn't require authentication can result in an\n",(0,a.kt)("inlineCode",{parentName:"p"},"invalid username/password")," error."),(0,a.kt)("h4",{id:"symptom-9"},"Symptom"),(0,a.kt)("p",null,"If you pull an anonymous image, one that should not require credentials, you can receive\nan ",(0,a.kt)("inlineCode",{parentName:"p"},"invalid username/password")," error if you have credentials established in the\nauthentication file for the target container registry that are no longer valid."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run -it --rm docker://docker.io/library/alpine:latest ls\nTrying to pull docker://docker.io/library/alpine:latest...ERRO[0000] Error pulling image ref //alpine:latest: Error determining manifest MIME type for docker://alpine:latest: unable to retrieve auth token: invalid username/password\nFailed\nError: unable to pull docker://docker.io/library/alpine:latest: unable to pull image: Error determining manifest MIME type for docker://alpine:latest: unable to retrieve auth token: invalid username/password\n")),(0,a.kt)("p",null,"This can happen if the authentication file is modified 'by hand' or if the credentials\nare established locally and then the password is updated later in the container registry."),(0,a.kt)("h4",{id:"solution-10"},"Solution"),(0,a.kt)("p",null,"Depending upon which container tool was used to establish the credentials, use ",(0,a.kt)("inlineCode",{parentName:"p"},"podman logout"),"\nor ",(0,a.kt)("inlineCode",{parentName:"p"},"docker logout")," to remove the credentials from the authentication file."),(0,a.kt)("h3",{id:"13-running-podman-inside-a-container-causes-container-crashes-and-inconsistent-states"},"13) Running Podman inside a container causes container crashes and inconsistent states"),(0,a.kt)("p",null,"Running Podman in a container and forwarding some, but not all, of the required host directories can cause inconsistent container behavior."),(0,a.kt)("h4",{id:"symptom-10"},"Symptom"),(0,a.kt)("p",null,'After creating a container with Podman\'s storage directories mounted in from the host and running Podman inside a container, all containers show their state as "configured" or "created", even if they were running or stopped.'),(0,a.kt)("h4",{id:"solution-11"},"Solution"),(0,a.kt)("p",null,"When running Podman inside a container, it is recommended to mount at a minimum ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/containers/storage/")," as a volume.\nTypically, you will not mount in the host version of the directory, but if you wish to share containers with the host, you can do so.\nIf you do mount in the host's ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/containers/storage"),", however, you must also mount in the host's ",(0,a.kt)("inlineCode",{parentName:"p"},"/run/libpod")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"/run/containers/storage")," directories.\nNot doing this will cause Podman in the container to detect that temporary files have been cleared, leading it to assume a system restart has taken place.\nThis can cause Podman to reset container states and lose track of running containers."),(0,a.kt)("p",null,"For running containers on the host from inside a container, we also recommend the ",(0,a.kt)("a",{parentName:"p",href:"/website-new/docs/tutorials/remote_client"},"Podman remote client"),", which only requires a single socket to be mounted into the container."),(0,a.kt)("h3",{id:"14-rootless-podman-build-fails-eperm-on-nfs"},"14) Rootless 'podman build' fails EPERM on NFS:"),(0,a.kt)("p",null,"NFS enforces file creation on different UIDs on the server side and does not understand user namespace, which rootless Podman requires.\nWhen a container root process like YUM attempts to create a file owned by a different UID, NFS Server denies the creation.\nNFS is also a problem for the file locks when the storage is on it. Other distributed file systems (for example: Lustre, Spectrum Scale, the General Parallel File System (GPFS)) are also not supported when running in rootless mode as these file systems do not understand user namespace."),(0,a.kt)("h4",{id:"symptom-11"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman build .\nERRO[0014] Error while applying layer: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied\nerror creating build container: Error committing the finished image: error adding layer with blob "sha256:a02a4930cb5d36f3290eb84f4bfa30668ef2e9fe3a1fb73ec015fc58b9958b17": ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied\n')),(0,a.kt)("h4",{id:"solution-12"},"Solution"),(0,a.kt)("p",null,"Choose one of the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Set up containers/storage in a different directory, not on an NFS share.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Create a directory on a local file system."),(0,a.kt)("li",{parentName:"ul"},"Edit ",(0,a.kt)("inlineCode",{parentName:"li"},"~/.config/containers/containers.conf")," and point the ",(0,a.kt)("inlineCode",{parentName:"li"},"volume_path")," option to that local directory. (Copy ",(0,a.kt)("inlineCode",{parentName:"li"},"/usr/share/containers/containers.conf")," if ",(0,a.kt)("inlineCode",{parentName:"li"},"~/.config/containers/containers.conf")," does not exist)"))),(0,a.kt)("li",{parentName:"ul"},"Otherwise just run Podman as root, via ",(0,a.kt)("inlineCode",{parentName:"li"},"sudo podman"))),(0,a.kt)("h3",{id:"15-rootless-podman-build-fails-when-using-overlayfs"},"15) Rootless 'podman build' fails when using OverlayFS:"),(0,a.kt)("p",null,"The Overlay file system (OverlayFS) requires the ability to call the ",(0,a.kt)("inlineCode",{parentName:"p"},"mknod")," command when creating whiteout files\nwhen extracting an image. However, a rootless user does not have the privileges to use ",(0,a.kt)("inlineCode",{parentName:"p"},"mknod")," in this capacity."),(0,a.kt)("h4",{id:"symptom-12"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman build --storage-driver overlay .\nSTEP 1: FROM docker.io/ubuntu:xenial\nGetting image source signatures\nCopying blob edf72af6d627 done\nCopying blob 3e4f86211d23 done\nCopying blob 8d3eac894db4 done\nCopying blob f7277927d38a done\nCopying config 5e13f8dd4c done\nWriting manifest to image destination\nStoring signatures\nError: creating build container: Error committing the finished image: error adding layer with blob "sha256:8d3eac894db4dc4154377ad28643dfe6625ff0e54bcfa63e0d04921f1a8ef7f8": Error processing tar file(exit status 1): operation not permitted\n$ podman build .\nERRO[0014] Error while applying layer: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied\nerror creating build container: Error committing the finished image: error adding layer with blob "sha256:a02a4930cb5d36f3290eb84f4bfa30668ef2e9fe3a1fb73ec015fc58b9958b17": ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied\n')),(0,a.kt)("h4",{id:"solution-13"},"Solution"),(0,a.kt)("p",null,"Choose one of the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Complete the build operation as a privileged user."),(0,a.kt)("li",{parentName:"ul"},"Install and configure fuse-overlayfs.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Install the fuse-overlayfs package for your Linux Distribution."),(0,a.kt)("li",{parentName:"ul"},"Add ",(0,a.kt)("inlineCode",{parentName:"li"},'mount_program = "/usr/bin/fuse-overlayfs"')," under ",(0,a.kt)("inlineCode",{parentName:"li"},"[storage.options]")," in your ",(0,a.kt)("inlineCode",{parentName:"li"},"~/.config/containers/storage.conf")," file.")))),(0,a.kt)("h3",{id:"16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2"},"16) RHEL 7 and CentOS 7 based ",(0,a.kt)("inlineCode",{parentName:"h3"},"init")," images don't work with cgroup v2"),(0,a.kt)("p",null,"The systemd version shipped in RHEL 7 and CentOS 7 doesn't have support for cgroup v2. Support for cgroup v2 requires version 230 of systemd or newer, which\nwas never shipped or supported on RHEL 7 or CentOS 7."),(0,a.kt)("h4",{id:"symptom-13"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# podman run --name test -d registry.access.redhat.com/rhel7-init:latest && sleep 10 && podman exec test systemctl status\nc8567461948439bce72fad3076a91ececfb7b14d469bfa5fbc32c6403185beff\nFailed to get D-Bus connection: Operation not permitted\nError: non zero exit code: 1: OCI runtime error\n")),(0,a.kt)("h4",{id:"solution-14"},"Solution"),(0,a.kt)("p",null,"You'll need to either:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"configure the host to use cgroup v1. On Fedora you can do:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'# dnf install -y grubby\n# grubby --update-kernel=ALL --args=\u201dsystemd.unified_cgroup_hierarchy=0"\n# reboot\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"update the image to use an updated version of systemd.")),(0,a.kt)("h3",{id:"17-rootless-containers-exit-once-the-user-session-exits"},"17) rootless containers exit once the user session exits"),(0,a.kt)("p",null,"You need to set lingering mode through loginctl to prevent user processes to be killed once\nthe user session completed."),(0,a.kt)("h4",{id:"symptom-14"},"Symptom"),(0,a.kt)("p",null,"Once the user logs out all the containers exit."),(0,a.kt)("h4",{id:"solution-15"},"Solution"),(0,a.kt)("p",null,"You'll need to either:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# loginctl enable-linger $UID\n")),(0,a.kt)("h3",{id:"18-podman-run-fails-with-bpf-create-permission-denied-error"},"18) ",(0,a.kt)("inlineCode",{parentName:"h3"},"podman run"),' fails with "bpf create: permission denied error"'),(0,a.kt)("p",null,"The Kernel Lockdown patches deny eBPF programs when Secure Boot is enabled in the BIOS. ",(0,a.kt)("a",{parentName:"p",href:"https://mjg59.dreamwidth.org/50577.html"},"Matthew Garrett's post")," describes the relationship between Lockdown and Secure Boot and ",(0,a.kt)("a",{parentName:"p",href:"https://gehrcke.de/2019/09/running-an-ebpf-program-may-require-lifting-the-kernel-lockdown/"},"Jan-Philip Gehrcke's")," connects this with eBPF. ",(0,a.kt)("a",{parentName:"p",href:"https://bugzilla.redhat.com/show_bug.cgi?id=1768125"},"RH bug 1768125")," contains some additional details."),(0,a.kt)("h4",{id:"symptom-15"},"Symptom"),(0,a.kt)("p",null,"Attempts to run podman result in"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Error: bpf create : Operation not permitted: OCI runtime permission denied error")),(0,a.kt)("h4",{id:"solution-16"},"Solution"),(0,a.kt)("p",null,"One workaround is to disable Secure Boot in your BIOS."),(0,a.kt)("h3",{id:"19-error-creating-libpod-runtime-there-might-not-be-enough-ids-available-in-the-namespace"},"19) error creating libpod runtime: there might not be enough IDs available in the namespace"),(0,a.kt)("p",null,"Unable to pull images"),(0,a.kt)("h4",{id:"symptom-16"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman unshare cat /proc/self/uid_map\n     0       1000          1\n")),(0,a.kt)("h4",{id:"solution-17"},"Solution"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman system migrate\n")),(0,a.kt)("p",null,"Original command now returns"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman unshare cat /proc/self/uid_map\n     0       1000          1\n     1     100000      65536\n")),(0,a.kt)("p",null,"Reference ",(0,a.kt)("a",{parentName:"p",href:"https://man7.org/linux/man-pages/man5/subuid.5.html"},"subuid")," and ",(0,a.kt)("a",{parentName:"p",href:"https://man7.org/linux/man-pages/man5/subgid.5.html"},"subgid")," man pages for more detail."),(0,a.kt)("h3",{id:"20-passed-in-devices-or-files-cant-be-accessed-in-rootless-container"},"20) Passed-in devices or files can't be accessed in rootless container"),(0,a.kt)("p",null,"As a non-root user you have group access rights to a device or files that you\nwant to pass into a rootless container with ",(0,a.kt)("inlineCode",{parentName:"p"},"--device=...")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"--volume=...")),(0,a.kt)("h4",{id:"symptom-17"},"Symptom"),(0,a.kt)("p",null,'Any access inside the container is rejected with "Permission denied".'),(0,a.kt)("h4",{id:"solution-18"},"Solution"),(0,a.kt)("p",null,"The runtime uses ",(0,a.kt)("inlineCode",{parentName:"p"},"setgroups(2)")," hence the process loses all additional groups\nthe non-root user has. Use the ",(0,a.kt)("inlineCode",{parentName:"p"},"--group-add keep-groups")," flag to pass the\nuser's supplementary group access into the container. Currently only available\nwith the ",(0,a.kt)("inlineCode",{parentName:"p"},"crun")," OCI runtime."),(0,a.kt)("h3",{id:"21-a-rootless-container-running-in-detached-mode-is-closed-at-logout"},"21) A rootless container running in detached mode is closed at logout"),(0,a.kt)("p",null,"When running a container with a command like ",(0,a.kt)("inlineCode",{parentName:"p"},"podman run --detach httpd")," as\na rootless user, the container is closed upon logout and is not kept running."),(0,a.kt)("h4",{id:"symptom-18"},"Symptom"),(0,a.kt)("p",null,"When logging out of a rootless user session, all containers that were started\nin detached mode are stopped and are not kept running. As the root user, these\nsame containers would survive the logout and continue running."),(0,a.kt)("h4",{id:"solution-19"},"Solution"),(0,a.kt)("p",null,"When systemd notes that a session that started a Podman container has exited,\nit will also stop any containers that have been associated with it. To avoid\nthis, use the following command before logging out: ",(0,a.kt)("inlineCode",{parentName:"p"},"loginctl enable-linger"),".\nTo later revert the linger functionality, use ",(0,a.kt)("inlineCode",{parentName:"p"},"loginctl disable-linger"),"."),(0,a.kt)("p",null,"LOGINCTL(1), SYSTEMD(1)"),(0,a.kt)("h3",{id:"22-containers-default-detach-keys-conflict-with-shell-history-navigation"},"22) Containers default detach keys conflict with shell history navigation"),(0,a.kt)("p",null,"Podman defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"ctrl-p,ctrl-q")," to detach from a running containers. The\nbash and zsh shells default to ",(0,a.kt)("inlineCode",{parentName:"p"},"ctrl-p")," for the displaying of the previous\ncommand. This causes issues when running a shell inside of a container."),(0,a.kt)("h4",{id:"symptom-19"},"Symptom"),(0,a.kt)("p",null,"With the default detach key combo ctrl-p,ctrl-q, shell history navigation\n(tested in bash and zsh) using ctrl-p to access the previous command will not\ndisplay this previous command, or anything else. Conmon is waiting for an\nadditional character to see if the user wants to detach from the container.\nAdding additional characters to the command will cause it to be displayed along\nwith the additional character. If the user types ctrl-p a second time the shell\ndisplay the 2nd to last command."),(0,a.kt)("h4",{id:"solution-20"},"Solution"),(0,a.kt)("p",null,"The solution to this is to change the default detach_keys. For example in order\nto change the defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"ctrl-q,ctrl-q")," use the ",(0,a.kt)("inlineCode",{parentName:"p"},"--detach-keys")," option."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run -ti --detach-keys ctrl-q,ctrl-q fedora sh\n")),(0,a.kt)("p",null,"To make this change the default for all containers, users can modify the\ncontainers.conf file. This can be done simply in your home directory, but adding the\nfollowing lines to users containers.conf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ cat >> ~/.config/containers/containers.conf << _eof\n[engine]\ndetach_keys="ctrl-q,ctrl-q"\n_eof\n')),(0,a.kt)("p",null,"In order to effect root running containers and all users, modify the system\nwide defaults in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/containers/containers.conf"),"."),(0,a.kt)("h3",{id:"23-container-with-exposed-ports-wont-run-in-a-pod"},"23) Container with exposed ports won't run in a pod"),(0,a.kt)("p",null,"A container with ports that have been published with the ",(0,a.kt)("inlineCode",{parentName:"p"},"--publish")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"-p")," option\ncan not be run within a pod."),(0,a.kt)("h4",{id:"symptom-20"},"Symptom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman pod create --name srcview -p 127.0.0.1:3434:3434 -p 127.0.0.1:7080:7080 -p 127.0.0.1:3370:3370                        4b2f4611fa2cbd60b3899b936368c2b3f4f0f68bc8e6593416e0ab8ecb0a3f1d\n\n$ podman run --pod srcview --name src-expose -p 3434:3434 -v "${PWD}:/var/opt/localrepo":Z,ro sourcegraph/src-expose:latest serve /var/opt/localrepo\nError: cannot set port bindings on an existing container network namespace\n')),(0,a.kt)("h4",{id:"solution-21"},"Solution"),(0,a.kt)("p",null,"This is a known limitation. If a container will be run within a pod, it is not necessary\nto publish the port for the containers in the pod. The port must only be published by the\npod itself. Pod network stacks act like the network stack on the host - you have a\nvariety of containers in the pod, and programs in the container, all sharing a single\ninterface and IP address, and associated ports. If one container binds to a port, no other\ncontainer can use that port within the pod while it is in use. Containers in the pod can\nalso communicate over localhost by having one container bind to localhost in the pod, and\nanother connect to that port."),(0,a.kt)("p",null,"In the example from the symptom section, dropping the ",(0,a.kt)("inlineCode",{parentName:"p"},"-p 3434:3434")," would allow the\n",(0,a.kt)("inlineCode",{parentName:"p"},"podman run")," command to complete, and the container as part of the pod would still have\naccess to that port. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman run --pod srcview --name src-expose -v "${PWD}:/var/opt/localrepo":Z,ro sourcegraph/src-expose:latest serve /var/opt/localrepo\n')),(0,a.kt)("h3",{id:"24-podman-container-images-fail-with-fuse-device-not-found-when-run"},"24) Podman container images fail with ",(0,a.kt)("inlineCode",{parentName:"h3"},"fuse: device not found")," when run"),(0,a.kt)("p",null,"Some container images require that the fuse kernel module is loaded in the kernel\nbefore they will run with the fuse filesystem in play."),(0,a.kt)("h4",{id:"symptom-21"},"Symptom"),(0,a.kt)("p",null,"When trying to run the container images found at quay.io/podman, quay.io/containers\nregistry.access.redhat.com/ubi8 or other locations, an error will sometimes be returned:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'ERRO error unmounting /var/lib/containers/storage/overlay/30c058cdadc888177361dd14a7ed7edab441c58525b341df321f07bc11440e68/merged: invalid argument\nerror mounting container "1ae176ca72b3da7c70af31db7434bcf6f94b07dbc0328bc7e4e8fc9579d0dc2e": error mounting build container "1ae176ca72b3da7c70af31db7434bcf6f94b07dbc0328bc7e4e8fc9579d0dc2e": error creating overlay mount to /var/lib/containers/storage/overlay/30c058cdadc888177361dd14a7ed7edab441c58525b341df321f07bc11440e68/merged: using mount program /usr/bin/fuse-overlayfs: fuse: device not found, try \'modprobe fuse\' first\nfuse-overlayfs: cannot mount: No such device\n: exit status 1\nERRO exit status 1\n')),(0,a.kt)("h4",{id:"solution-22"},"Solution"),(0,a.kt)("p",null,"If you encounter a ",(0,a.kt)("inlineCode",{parentName:"p"},"fuse: device not found")," error when running the container image, it is likely that\nthe fuse kernel module has not been loaded on your host system. Use the command ",(0,a.kt)("inlineCode",{parentName:"p"},"modprobe fuse")," to load the\nmodule and then run the container image afterwards. To enable this automatically at boot time, you can add a configuration\nfile to ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/modules.load.d"),". See ",(0,a.kt)("inlineCode",{parentName:"p"},"man modules-load.d")," for more details."),(0,a.kt)("h3",{id:"25-podman-run---rootfs-linktoreadonlydir-does-not-work"},"25) podman run --rootfs link/to//read/only/dir does not work"),(0,a.kt)("p",null,'An error such as "OCI runtime error" on a read-only filesystem or the error "{image} is not an absolute path or is a symlink" are often times indicators for this issue. For more details, review this ',(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/issues/5895"},"issue"),"."),(0,a.kt)("h4",{id:"symptom-22"},"Symptom"),(0,a.kt)("p",null,"Rootless Podman requires certain files to exist in a file system in order to run.\nPodman will create /etc/resolv.conf, /etc/hosts and other file descriptors on the rootfs in order\nto mount volumes on them."),(0,a.kt)("h4",{id:"solution-23"},"Solution"),(0,a.kt)("p",null,"Run the container once in read/write mode, Podman will generate all of the FDs on the rootfs, and\nfrom that point forward you can run with a read-only rootfs."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run --rm --rootfs /path/to/rootfs true\n")),(0,a.kt)("p",null,"The command above will create all the missing directories needed to run the container."),(0,a.kt)("p",null,"After that, it can be used in read-only mode, by multiple containers at the same time:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run --read-only --rootfs /path/to/rootfs ....\n")),(0,a.kt)("p",null,"Another option is to use an Overlay Rootfs Mount:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman run --rootfs /path/to/rootfs:O ....\n")),(0,a.kt)("p",null,"Modifications to the mount point are destroyed when the container\nfinishes executing, similar to a tmpfs mount point being unmounted."),(0,a.kt)("h3",{id:"26-running-containers-with-resource-limits-fails-with-a-permissions-error"},"26) Running containers with resource limits fails with a permissions error"),(0,a.kt)("p",null,"On some systemd-based systems, non-root users do not have resource limit delegation\npermissions. This causes setting resource limits to fail."),(0,a.kt)("h4",{id:"symptom-23"},"Symptom"),(0,a.kt)("p",null,"Running a container with a resource limit options will fail with an error similar to the following:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"--cpus"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"--cpu-period"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"--cpu-quota"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"--cpu-shares"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Error: OCI runtime error: crun: the requested cgroup controller `cpu` is not available\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"--cpuset-cpus"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"--cpuset-mems"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Error: OCI runtime error: crun: the requested cgroup controller `cpuset` is not available\n")),(0,a.kt)("p",null,"This means that resource limit delegation is not enabled for the current user."),(0,a.kt)("h4",{id:"solution-24"},"Solution"),(0,a.kt)("p",null,"You can verify whether resource limit delegation is enabled by running the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ cat "/sys/fs/cgroup/user.slice/user-$(id -u).slice/user@$(id -u).service/cgroup.controllers"\n')),(0,a.kt)("p",null,"Example output might be:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"memory pids\n")),(0,a.kt)("p",null,"In the above example, ",(0,a.kt)("inlineCode",{parentName:"p"},"cpu")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"cpuset")," are not listed, which means the current user does\nnot have permission to set CPU or CPUSET limits."),(0,a.kt)("p",null,"If you want to enable CPU or CPUSET limit delegation for all users, you can create the\nfile ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/user@.service.d/delegate.conf")," with the contents:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[Service]\nDelegate=memory pids cpu cpuset\n")),(0,a.kt)("p",null,"After logging out and logging back in, you should have permission to set\nCPU and CPUSET limits."),(0,a.kt)("h3",{id:"27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh"},"27) ",(0,a.kt)("inlineCode",{parentName:"h3"},"exec container process '/bin/sh': Exec format error")," (or another binary than ",(0,a.kt)("inlineCode",{parentName:"h3"},"bin/sh"),")"),(0,a.kt)("p",null,"This can happen when running a container from an image for another architecture than the one you are running on."),(0,a.kt)("p",null,"For example, if a remote repository only has, and thus send you, a ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/arm64")," ",(0,a.kt)("em",{parentName:"p"},"OS/ARCH")," but you run on ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/amd64")," (as happened in ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/openMF/community-app/issues/3323"},"https://github.com/openMF/community-app/issues/3323")," due to ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/timbru31/docker-ruby-node/issues/564"},"https://github.com/timbru31/docker-ruby-node/issues/564"),")."),(0,a.kt)("h3",{id:"28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain"},"28) ",(0,a.kt)("inlineCode",{parentName:"h3"},"Error: failed to create sshClient: Connection to bastion host (ssh://user@host:22/run/user/.../podman/podman.sock) failed.: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain")),(0,a.kt)("p",null,"In some situations where the client is not on the same machine as where the podman daemon is running the client key could be using a cipher not supported by the host. This indicates an issue with one's SSH config. Until remedied using podman over ssh\nwith a pre-shared key will be impossible."),(0,a.kt)("h4",{id:"symptom-24"},"Symptom"),(0,a.kt)("p",null,"The accepted ciphers per ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/crypto-policies/back-ends/openssh.config")," are not one that was used to create the public/private key pair that was transferred over to the host for ssh authentication."),(0,a.kt)("p",null,"You can confirm this is the case by attempting to connect to the host via ",(0,a.kt)("inlineCode",{parentName:"p"},"podman-remote info")," from the client and simultaneously on the host running ",(0,a.kt)("inlineCode",{parentName:"p"},"journalctl -f")," and watching for the error ",(0,a.kt)("inlineCode",{parentName:"p"},"userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]"),"."),(0,a.kt)("h4",{id:"solution-25"},"Solution"),(0,a.kt)("p",null,"Create a new key using a supported algorithm e.g. ecdsa:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ ssh-keygen -t ecdsa -f ~/.ssh/podman\n")),(0,a.kt)("p",null,"Then copy the new id over:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ ssh-copy-id -i ~/.ssh/podman.pub user@host\n")),(0,a.kt)("p",null,"And then re-add the connection (removing the old one if necessary):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman-remote system connection add myuser --identity ~/.ssh/podman ssh://user@host/run/user/1000/podman/podman.sock\n")),(0,a.kt)("p",null,"And now this should work:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ podman-remote info\n")),(0,a.kt)("h3",{id:"29-rootless-cni-networking-fails-in-rhel-with-podman-v221-to-v301"},"29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1."),(0,a.kt)("p",null,"A failure is encountered when trying to use networking on a rootless\ncontainer in Podman v2.2.1 through v3.0.1 on RHEL. This error does not\noccur on other Linux distributions."),(0,a.kt)("h4",{id:"symptom-25"},"Symptom"),(0,a.kt)("p",null,"A rootless container is created using a CNI network, but the ",(0,a.kt)("inlineCode",{parentName:"p"},"podman run")," command\nreturns an error that an image must be built."),(0,a.kt)("h4",{id:"solution-26"},"Solution"),(0,a.kt)("p",null,"In order to use a CNI network in a rootless container on RHEL,\nan Infra container image for CNI-in-slirp4netns must be created. The\ninstructions for building the Infra container image can be found for\nv2.2.1 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/tree/v2.2.1-rhel/contrib/rootless-cni-infra"},"here"),",\nand for v3.0.1 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/tree/v3.0.1-rhel/contrib/rootless-cni-infra"},"here"),"."),(0,a.kt)("h3",{id:"30-container-related-firewall-rules-are-lost-after-reloading-firewalld"},"30) Container related firewall rules are lost after reloading firewalld"),(0,a.kt)("p",null,"Container network can't be reached after ",(0,a.kt)("inlineCode",{parentName:"p"},"firewall-cmd --reload")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl restart firewalld")," Running ",(0,a.kt)("inlineCode",{parentName:"p"},"podman network reload")," will fix it but it has to be done manually."),(0,a.kt)("h4",{id:"symptom-26"},"Symptom"),(0,a.kt)("p",null,"The firewall rules created by podman are lost when the firewall is reloaded."),(0,a.kt)("h4",{id:"solution-27"},"Solution"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/issues/5431#issuecomment-847758377"},"@ranjithrajaram")," has created a systemd-hook to fix this issue"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},'For "firewall-cmd --reload", create a systemd unit file with the following')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},'[Unit]\nDescription=firewalld reload hook - run a hook script on firewalld reload\nWants=dbus.service\nAfter=dbus.service\n\n[Service]\nType=simple\nExecStart=/bin/bash -c \'/bin/busctl monitor --system --match "interface=org.fedoraproject.FirewallD1,member=Reloaded" --match "interface=org.fedoraproject.FirewallD1,member=PropertiesChanged" | while read -r line ; do podman network reload --all ; done\'\n\n[Install]\nWantedBy=default.target\n')),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},'For "systemctl restart firewalld", create a systemd unit file with the following')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[Unit]\nDescription=podman network reload\nWants=firewalld.service\nAfter=firewalld.service\nPartOf=firewalld.service\n\n[Service]\nType=simple\nRemainAfterExit=yes\nExecStart=/usr/bin/podman network reload --all\n\n[Install]\nWantedBy=default.target\n")),(0,a.kt)("p",null,"However, If you use busctl monitor then you can't get machine-readable output on RHEL 8.\nSince it doesn't have ",(0,a.kt)("inlineCode",{parentName:"p"},"busctl -j")," as mentioned here by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/containers/podman/issues/5431#issuecomment-896943018"},"@yrro"),"."),(0,a.kt)("p",null,"For RHEL 8, you can use the following one-liner bash script."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[Unit]\nDescription=Redo podman NAT rules after firewalld starts or reloads\nWants=dbus.service\nAfter=dbus.service\nRequires=firewalld.service\n\n[Service]\nType=simple\nExecStart=/bin/bash -c \"dbus-monitor --profile --system 'type=signal,sender=org.freedesktop.DBus,path=/org/freedesktop/DBus,interface=org.freedesktop.DBus,member=NameAcquired,arg0=org.fedoraproject.FirewallD1' 'type=signal,path=/org/fedoraproject/FirewallD1,interface=org.fedoraproject.FirewallD1,member=Reloaded' | sed -u '/^#/d' | while read -r type timestamp serial sender destination path interface member _junk; do if [[ $type = '#'* ]]; then continue; elif [[ $interface = org.freedesktop.DBus && $member = NameAcquired ]]; then echo 'firewalld started'; podman network reload --all; elif [[ $interface = org.fedoraproject.FirewallD1 && $member = Reloaded ]]; then echo 'firewalld reloaded'; podman network reload --all; fi; done\"\nRestart=Always\n\n[Install]\nWantedBy=default.target\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"busctl-monitor")," is almost usable in RHEL 8, except that it always outputs two bogus events when it starts up,\none of which is (in its only machine-readable format) indistinguishable from the ",(0,a.kt)("inlineCode",{parentName:"p"},"NameOwnerChanged")," that you get when firewalld starts up.\nThis means you would get an extra ",(0,a.kt)("inlineCode",{parentName:"p"},"podman network reload --all")," when this unit starts."),(0,a.kt)("p",null,"Apart from this, you can use the following systemd service with the python3 code."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ini"},"[Unit]\nDescription=Redo podman NAT rules after firewalld starts or reloads\nWants=dbus.service\nRequires=firewalld.service\nAfter=dbus.service\n\n[Service]\nType=simple\nExecStart=/usr/bin/python  /path/to/python/code/podman-redo-nat.py\nRestart=always\n\n[Install]\nWantedBy=default.target\n")),(0,a.kt)("p",null,"The code reloads podman network twice when you use ",(0,a.kt)("inlineCode",{parentName:"p"},"systemctl restart firewalld"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python3"},'import dbus\nfrom gi.repository import GLib\nfrom dbus.mainloop.glib import DBusGMainLoop\nimport subprocess\nimport sys\n\n# I\'m a bit confused on the return values in the code\n# Not sure if they are needed.\n\ndef reload_podman_network():\n    try:\n        subprocess.run(["podman","network","reload","--all"],timeout=90)\n        # I\'m not sure about this part\n        sys.stdout.write("podman network reload done\\n")\n        sys.stdout.flush()\n    except subprocess.TimeoutExpired as t:\n        sys.stderr.write(f"Podman reload failed due to Timeout {t}")\n    except subprocess.CalledProcessError as e:\n        sys.stderr.write(f"Podman reload failed due to {e}")\n    except Exception as e:\n        sys.stderr.write(f"Podman reload failed with an Unhandled Exception {e}")\n\n    return False\n\ndef signal_handler(*args, **kwargs):\n    if kwargs.get(\'member\') == "Reloaded":\n        reload_podman_network()\n    elif kwargs.get(\'member\') == "NameOwnerChanged":\n        reload_podman_network()\n    else:\n        return None\n    return None\n\ndef signal_listener():\n    try:\n        DBusGMainLoop(set_as_default=True)# Define the loop.\n        loop = GLib.MainLoop()\n        system_bus = dbus.SystemBus()\n        # Listens to systemctl restart firewalld with a filter added, will cause podman network to be reloaded twice\n        system_bus.add_signal_receiver(signal_handler,dbus_interface=\'org.freedesktop.DBus\',arg0=\'org.fedoraproject.FirewallD1\',member_keyword=\'member\')\n        # Listens to firewall-cmd --reload\n        system_bus.add_signal_receiver(signal_handler,dbus_interface=\'org.fedoraproject.FirewallD1\',signal_name=\'Reloaded\',member_keyword=\'member\')\n        loop.run()\n    except KeyboardInterrupt:\n        loop.quit()\n        sys.exit(0)\n    except Exception as e:\n        loop.quit()\n        sys.stderr.write(f"Error occurred {e}")\n        sys.exit(1)\n\nif __name__ == "__main__":\n    signal_listener()\n')),(0,a.kt)("h3",{id:"31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied"},"31) Podman run fails with ",(0,a.kt)("inlineCode",{parentName:"h3"},'ERRO[0000] XDG_RUNTIME_DIR directory "/run/user/0" is not owned by the current user')," or ",(0,a.kt)("inlineCode",{parentName:"h3"},"Error: creating tmpdir: mkdir /run/user/1000: permission denied"),"."),(0,a.kt)("p",null,"A failure is encountered when performing ",(0,a.kt)("inlineCode",{parentName:"p"},"podman run")," with a warning ",(0,a.kt)("inlineCode",{parentName:"p"},"XDG_RUNTIME_DIR is pointing to a path which is not writable. Most likely podman will fail.")),(0,a.kt)("h4",{id:"symptom-27"},"Symptom"),(0,a.kt)("p",null,"A rootless container is being invoked with cgroup configuration as ",(0,a.kt)("inlineCode",{parentName:"p"},"cgroupv2")," for user with missing or invalid ",(0,a.kt)("strong",{parentName:"p"},"systemd session"),"."),(0,a.kt)("p",null,"Example cases"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# su user1 -c 'podman images'\nERRO[0000] XDG_RUNTIME_DIR directory \"/run/user/0\" is not owned by the current user\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"# su - user1 -c 'podman images'\nError: creating tmpdir: mkdir /run/user/1000: permission denied\n")),(0,a.kt)("h4",{id:"solution-28"},"Solution"),(0,a.kt)("p",null,"Podman expects a valid login session for the ",(0,a.kt)("inlineCode",{parentName:"p"},"rootless+cgroupv2")," use-case. Podman execution is expected to fail if the login session is not present. In most cases, podman will figure out a solution on its own but if ",(0,a.kt)("inlineCode",{parentName:"p"},"XDG_RUNTIME_DIR")," is pointing to a path that is not writable execution will most likely fail. Typical scenarios of such cases are seen when users are trying to use Podman with ",(0,a.kt)("inlineCode",{parentName:"p"},"su - <user> -c '<podman-command>'"),", or ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo -l")," and badly configured systemd session."),(0,a.kt)("p",null,"Alternatives:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Execute Podman via ",(0,a.kt)("strong",{parentName:"p"},"systemd-run")," that will first start a systemd login session:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ sudo systemd-run --machine=username@ --quiet --user --collect --pipe --wait podman run --rm docker.io/library/alpine echo hello\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Start an interactive shell in a systemd login session with the command ",(0,a.kt)("inlineCode",{parentName:"p"},"machinectl shell <username>@"),"\nand then run Podman"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ sudo -i\n# machinectl shell username@\nConnected to the local host. Press ^] three times within 1s to exit session.\n$ podman run --rm docker.io/library/alpine echo hello\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Start a new systemd login session by logging in with ",(0,a.kt)("inlineCode",{parentName:"p"},"ssh")," i.e. ",(0,a.kt)("inlineCode",{parentName:"p"},"ssh <username>@localhost")," and then run Podman.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Before invoking Podman command create a valid login session for your rootless user using ",(0,a.kt)("inlineCode",{parentName:"p"},"loginctl enable-linger <username>")))),(0,a.kt)("h3",{id:"32-1270017777-port-already-bound"},"32) 127.0.0.1:7777 port already bound"),(0,a.kt)("p",null,"After deleting a VM on macOS, the initialization of subsequent VMs fails."),(0,a.kt)("h4",{id:"symptom-28"},"Symptom"),(0,a.kt)("p",null,"After deleting a client VM on macOS via ",(0,a.kt)("inlineCode",{parentName:"p"},"podman machine stop")," && ",(0,a.kt)("inlineCode",{parentName:"p"},"podman machine rm"),", attempting to ",(0,a.kt)("inlineCode",{parentName:"p"},"podman machine init")," a new client VM leads to an error with the 127.0.0.1:7777 port already bound."),(0,a.kt)("h4",{id:"solution-29"},"Solution"),(0,a.kt)("p",null,"You will need to remove the hanging gv-proxy process bound to the port in question. For example, if the port mentioned in the error message is 127.0.0.1:7777, you can use the command ",(0,a.kt)("inlineCode",{parentName:"p"},"kill -9 $(lsof -i:7777)")," in order to identify and remove the hanging process which prevents you from starting a new VM on that default port."),(0,a.kt)("h3",{id:"33-the-sshd-process-fails-to-run-inside-of-the-container"},"33) The sshd process fails to run inside of the container."),(0,a.kt)("h4",{id:"symptom-29"},"Symptom"),(0,a.kt)("p",null,'The sshd process running inside the container fails with the error\n"Error writing /proc/self/loginuid".'),(0,a.kt)("h3",{id:"solution-30"},"Solution"),(0,a.kt)("p",null,"If the ",(0,a.kt)("inlineCode",{parentName:"p"},"/proc/self/loginuid")," file is already initialized then the\n",(0,a.kt)("inlineCode",{parentName:"p"},"CAP_AUDIT_CONTROL")," capability is required to override it."),(0,a.kt)("p",null,"This happens when running Podman from a user session since the\n",(0,a.kt)("inlineCode",{parentName:"p"},"/proc/self/loginuid")," file is already initialized. The solution is to\nrun Podman from a system service, either using the Podman service, and\nthen using podman -remote to start the container or simply by running\nsomething like ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd-run podman run ..."),". In this case the\ncontainer will only need ",(0,a.kt)("inlineCode",{parentName:"p"},"CAP_AUDIT_WRITE"),"."),(0,a.kt)("h3",{id:"34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid"},"34) Container creates a file that is not owned by the user's regular UID"),(0,a.kt)("p",null,"After running a container with rootless Podman, the non-root user sees a numerical UID and GID instead of a username and groupname."),(0,a.kt)("h4",{id:"symptom-30"},"Symptom"),(0,a.kt)("p",null,"When listing file permissions with ",(0,a.kt)("inlineCode",{parentName:"p"},"ls -l")," on the host in a directory that was passed as ",(0,a.kt)("inlineCode",{parentName:"p"},"--volume /some/dir")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"podman run"),",\nthe UID and GID are displayed rather than the corresponding username and groupname. The UID and GID numbers displayed are\nfrom the user's subordinate UID and GID ranges on the host system."),(0,a.kt)("p",null,"An example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ mkdir dir1\n$ chmod 777 dir1\n$ podman run --rm -v ./dir1:/dir1:Z \\\n             --user 2003:2003 \\\n             docker.io/library/ubuntu bash -c "touch /dir1/a; chmod 600 /dir1/a"\n$ ls -l dir1/a\n-rw-------. 1 102002 102002 0 Jan 19 19:35 dir1/a\n$ less dir1/a\nless: dir1/a: Permission denied\n')),(0,a.kt)("h4",{id:"solution-31"},"Solution"),(0,a.kt)("p",null,"If you want to read, chown, or remove such a file, enter a user\nnamespace. Instead of running commands such as ",(0,a.kt)("inlineCode",{parentName:"p"},"less dir1/a")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"rm dir1/a"),", you\nneed to prepend the command-line with ",(0,a.kt)("inlineCode",{parentName:"p"},"podman unshare"),", i.e.,\n",(0,a.kt)("inlineCode",{parentName:"p"},"podman unshare less dir1/a")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"podman unshare rm dir1/a"),". To change the ownership\nof the file ",(0,a.kt)("inlineCode",{parentName:"p"},"dir1/a")," to your regular user's UID and GID, run ",(0,a.kt)("inlineCode",{parentName:"p"},"podman unshare chown 0:0 dir1/a"),".\nA file having the ownership ",(0,a.kt)("inlineCode",{parentName:"p"},"0:0")," in the user namespace is owned by the regular\nuser on the host. To use Bash features, such as variable expansion and\nglobbing, you need to wrap the command with ",(0,a.kt)("inlineCode",{parentName:"p"},"bash -c"),", e.g.\n",(0,a.kt)("inlineCode",{parentName:"p"},"podman unshare bash -c 'ls $HOME/dir1/a*'"),"."),(0,a.kt)("p",null,"Would it have been possible to run Podman in another way so that your regular\nuser would have become the owner of the file? Yes, you can use the option\n",(0,a.kt)("inlineCode",{parentName:"p"},"--userns keep-id:uid=$uid,gid=$gid")," to change how UIDs and GIDs are mapped\nbetween the container and the host. Let's try it out."),(0,a.kt)("p",null,"In the example above ",(0,a.kt)("inlineCode",{parentName:"p"},"ls -l")," shows the UID 102002 and GID 102002. Set shell variables"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ uid_from_ls=102002\n$ gid_from_ls=102002\n")),(0,a.kt)("p",null,"Set shell variables to the lowest subordinate UID and GID"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ lowest_subuid=$(podman info --format "{{ (index .Host.IDMappings.UIDMap 1).HostID }}")\n$ lowest_subgid=$(podman info --format "{{ (index .Host.IDMappings.GIDMap 1).HostID }}")\n')),(0,a.kt)("p",null,"Compute the UID and GID inside the container that map to the owner of the created file on the host."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ uid=$(( $uid_from_ls - $lowest_subuid + 1))\n$ gid=$(( $gid_from_ls - $lowest_subgid + 1))\n")),(0,a.kt)("p",null,"(In the computation it was assumed that there is only one subuid range and one subgid range)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ echo $uid\n2003\n$ echo $gid\n2003\n")),(0,a.kt)("p",null,"The computation shows that the UID is ",(0,a.kt)("inlineCode",{parentName:"p"},"2003")," and the GID is ",(0,a.kt)("inlineCode",{parentName:"p"},"2003")," inside the container.\nThis comes as no surprise as this is what was specified before with ",(0,a.kt)("inlineCode",{parentName:"p"},"--user=2003:2003"),",\nbut the same computation could be used whenever a username is specified\nor the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," option is not used."),(0,a.kt)("p",null,"Run the container again but now with UIDs and GIDs mapped"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ mkdir dir1\n$ chmod 777 dir1\n$ podman run --rm\n  -v ./dir1:/dir1:Z \\\n  --user $uid:$gid \\\n  --userns keep-id:uid=$uid,gid=$gid \\\n     docker.io/library/ubuntu bash -c "touch /dir1/a; chmod 600 /dir1/a"\n$ id -u\ntester\n$ id -g\ntester\n$ ls -l dir1/a\n-rw-------. 1 tester tester 0 Jan 19 20:31 dir1/a\n$\n')),(0,a.kt)("p",null,"In this example the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," option specified a rootless user in the container.\nAs the rootless user could also have been specified in the container image, e.g."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman image inspect --format "user: {{.User}}" IMAGE\nuser: hpc\n')),(0,a.kt)("p",null,"the same problem could also occur even without specifying ",(0,a.kt)("inlineCode",{parentName:"p"},"--user"),"."),(0,a.kt)("p",null,"Another variant of the same problem could occur when using\n",(0,a.kt)("inlineCode",{parentName:"p"},"--user=root:root")," (the default), but where the root user creates non-root owned files\nin some way (e.g by creating them themselves, or switching the effective UID to\na rootless user and then creates files)."),(0,a.kt)("p",null,"See also the troubleshooting tip:"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed"},(0,a.kt)("em",{parentName:"a"},'Podman run fails with "Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed"'))),(0,a.kt)("h3",{id:"35-passed-in-devices-or-files-cant-be-accessed-in-rootless-container-uidgid-mapping-problem"},"35) Passed-in devices or files can't be accessed in rootless container (UID/GID mapping problem)"),(0,a.kt)("p",null,"As a non-root user you have access rights to devices, files and directories that you\nwant to pass into a rootless container with ",(0,a.kt)("inlineCode",{parentName:"p"},"--device=..."),", ",(0,a.kt)("inlineCode",{parentName:"p"},"--volume=...")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"--mount=.."),"."),(0,a.kt)("p",null,'Podman by default maps a non-root user inside a container to one of the user\'s\nsubordinate UIDs and subordinate GIDs on the host. When the container user tries to access a\nfile, a "Permission denied" error could occur because the container user does not have the\npermissions of the regular user of the host.'),(0,a.kt)("h4",{id:"symptom-31"},"Symptom"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Any access inside the container is rejected with "Permission denied"\nfor files, directories or devices passed in to the container\nwith ',(0,a.kt)("inlineCode",{parentName:"li"},"--device=.."),",",(0,a.kt)("inlineCode",{parentName:"li"},"--volume=..")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"--mount=.."),", e.g.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ mkdir dir1\n$ chmod 700 dir1\n$ podman run --rm -v ./dir1:/dir1:Z \\\n             --user 2003:2003 \\\n             docker.io/library/ubuntu ls /dir1\nls: cannot open directory '/dir1': Permission denied\n")),(0,a.kt)("h4",{id:"solution-32"},"Solution"),(0,a.kt)("p",null,"We follow essentially the same solution as in the previous\ntroubleshooting tip:"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"#34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid"},(0,a.kt)("em",{parentName:"a"},"Container creates a file that is not owned by the user's regular UID"))),(0,a.kt)("p",null,"but for this problem the container UID and GID can't be as\neasily computed by mere addition and subtraction."),(0,a.kt)("p",null,"In other words, it might be more challenging to find out the UID and\nthe GID inside the container that we want to map to the regular\nuser on the host."),(0,a.kt)("p",null,"If the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," option is used together with a numerical UID and GID\nto specify a rootless user, we already know the answer."),(0,a.kt)("p",null,"If the ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," option is used together with a username and groupname,\nwe could look up the UID and GID in the file ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," of the container."),(0,a.kt)("p",null,"If the container user is not set via ",(0,a.kt)("inlineCode",{parentName:"p"},"--user")," but instead from the\ncontainer image, we could inspect the container image"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'$ podman image inspect --format "user: {{.User}}" IMAGE\nuser: hpc\n')),(0,a.kt)("p",null,"and then look it up in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," of the container."),(0,a.kt)("p",null,"If the problem occurs in a container that is started to run as root but later\nswitches to an effictive UID of a rootless user, it might be less\nstraightforward to find out the UID and the GID. Reading the\n",(0,a.kt)("inlineCode",{parentName:"p"},"Containerfile"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile")," or the ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," could give a clue."),(0,a.kt)("p",null,"To run the container with the rootless container UID and GID mapped to the\nuser's regular UID and GID on the host follow these steps:"),(0,a.kt)("p",null,"Set the ",(0,a.kt)("inlineCode",{parentName:"p"},"uid")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"gid")," shell variables in a Bash shell to the UID and GID\nof the user that will be running inside the container, e.g."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ uid=2003\n$ gid=2003\n")),(0,a.kt)("p",null,"and run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ mkdir dir1\n$ echo hello > dir1/file.txt\n$ chmod 700 dir1/file.txt\n$ podman run --rm \\\n  -v ./dir1:/dir1:Z \\\n  --user $uid:$gid \\\n  --userns keep-id:uid=$uid,gid=$gid \\\n  docker.io/library/alpine cat /dir1/file.txt\nhello\n")),(0,a.kt)("p",null,"See also the troubleshooting tip:"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed"},(0,a.kt)("em",{parentName:"a"},'Podman run fails with "Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed"'))),(0,a.kt)("h3",{id:"36-images-in-the-additional-stores-can-be-deleted-even-if-there-are-containers-using-them"},"36) Images in the additional stores can be deleted even if there are containers using them"),(0,a.kt)("p",null,"When an image in an additional store is used, it is not locked thus it\ncan be deleted even if there are containers using it."),(0,a.kt)("h4",{id:"symptom-32"},"Symptom"),(0,a.kt)("p",null,"WARN","[0000]",' Can\'t stat lower layer "/var/lib/containers/storage/overlay/l/7HS76F2P5N73FDUKUQAOJA3WI5" because it does not exist. Going through storage to recreate the missing symlinks.'),(0,a.kt)("h4",{id:"solution-33"},"Solution"),(0,a.kt)("p",null,"It is the user responsibility to make sure images in an additional\nstore are not deleted while being used by containers in another\nstore."),(0,a.kt)("h3",{id:"37-syncing-bugfixes-for-podman-remote-or-setups-using-podman-api"},"37) Syncing bugfixes for podman-remote or setups using Podman API"),(0,a.kt)("p",null,"After upgrading Podman to a newer version an issue with the earlier version of Podman still presents itself while using podman-remote."),(0,a.kt)("h4",{id:"symptom-33"},"Symptom"),(0,a.kt)("p",null,"While running podman remote commands with the most updated Podman, issues that were fixed in a prior version of Podman can arise either on the Podman client side or the Podman server side."),(0,a.kt)("h4",{id:"solution-34"},"Solution"),(0,a.kt)("p",null,"When upgrading Podman to a particular version for the required fixes, users often make the mistake of only upgrading the Podman client. However, suppose a setup uses ",(0,a.kt)("inlineCode",{parentName:"p"},"podman-remote")," or uses a client that communicates with the Podman server on a remote machine via the REST API. In that case, it is required to upgrade both the Podman client and the Podman server running on the remote machine. Both the Podman client and server must be upgraded to the same version."),(0,a.kt)("p",null,"Example: If a particular bug was fixed in ",(0,a.kt)("inlineCode",{parentName:"p"},"v4.1.0")," then the Podman client must have version ",(0,a.kt)("inlineCode",{parentName:"p"},"v4.1.0")," as well the Podman server must have version ",(0,a.kt)("inlineCode",{parentName:"p"},"v4.1.0"),"."),(0,a.kt)("h3",{id:"38-unexpected-carriage-returns-are-outputted-on-the-terminal"},"38) Unexpected carriage returns are outputted on the terminal"),(0,a.kt)("p",null,"When using the ",(0,a.kt)("strong",{parentName:"p"},"--tty")," (",(0,a.kt)("strong",{parentName:"p"},"-t"),") flag, unexpected carriage returns are outputted on the terminal."),(0,a.kt)("h4",{id:"symptom-34"},"Symptom"),(0,a.kt)("p",null,"The container program prints a newline (",(0,a.kt)("inlineCode",{parentName:"p"},"\\n"),") but the terminal outputs a carriage return and a newline (",(0,a.kt)("inlineCode",{parentName:"p"},"\\r\\n"),")."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ podman run --rm -t fedora echo abc | od -c\n0000000   a   b   c  \\r  \\n\n0000005\n")),(0,a.kt)("p",null,"When run directly on the host, the result is as expected."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ echo abc | od -c\n0000000   a   b   c  \\n\n0000004\n")),(0,a.kt)("p",null,"Extra carriage returns can also shift the prompt to the right."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'$ podman run --rm -t fedora sh -c "echo 1; echo 2; echo 3" | cat -A\n1^M$\n    2^M$\n        3^M$\n            $\n')),(0,a.kt)("h4",{id:"solution-35"},"Solution"),(0,a.kt)("p",null,"Run Podman without the ",(0,a.kt)("strong",{parentName:"p"},"--tty")," (",(0,a.kt)("strong",{parentName:"p"},"-t"),") flag."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ podman run --rm fedora echo abc | od -c\n0000000   a   b   c  \\n\n0000004\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"--tty")," (",(0,a.kt)("strong",{parentName:"p"},"-t"),") flag should only be used when the program requires user interaction in the termainal, for instance expecting\nthe user to type an answer to a question."),(0,a.kt)("p",null,"Where does the extra carriage return ",(0,a.kt)("inlineCode",{parentName:"p"},"\\r")," come from?"),(0,a.kt)("p",null,"The extra ",(0,a.kt)("inlineCode",{parentName:"p"},"\\r")," is not outputted by Podman but by the terminal. In fact, a reconfiguration of the terminal can make the extra ",(0,a.kt)("inlineCode",{parentName:"p"},"\\r")," go away."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'$ podman run --rm -t fedora /bin/sh -c "stty -onlcr && echo abc" | od -c\n0000000   a   b   c  \\n\n0000004\n')),(0,a.kt)("h3",{id:"39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed"},'39) Podman run fails with "Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed"'),(0,a.kt)("p",null,"Podman 4.3.0 introduced the options ",(0,a.kt)("em",{parentName:"p"},"uid")," and ",(0,a.kt)("em",{parentName:"p"},"gid")," that can be given to ",(0,a.kt)("inlineCode",{parentName:"p"},"--userns keep-id")," which are not recognized by older versions of Podman."),(0,a.kt)("h4",{id:"symptom-35"},"Symptom"),(0,a.kt)("p",null,"When using a Podman version older than 4.3.0, the options ",(0,a.kt)("em",{parentName:"p"},"uid")," and ",(0,a.kt)("em",{parentName:"p"},"gid"),' are not recognized, and an "unrecognized namespace mode" error is raised.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ uid=1000\n$ gid=1000\n$ podman run --rm\n  --user $uid:$gid \\\n  --userns keep-id:uid=$uid,gid=$gid \\\n     docker.io/library/ubuntu /bin/cat /proc/self/uid_map\nError: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed\n$\n")),(0,a.kt)("h4",{id:"solution-36"},"Solution"),(0,a.kt)("p",null,"Use ",(0,a.kt)("strong",{parentName:"p"},"--uidmap")," and ",(0,a.kt)("strong",{parentName:"p"},"--gidmap")," options to describe the same UID and GID mapping."),(0,a.kt)("p",null,"Run"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'$ uid=1000\n$ gid=1000\n$ subuidSize=$(( $(podman info --format "{{ range \\\n   .Host.IDMappings.UIDMap }}+{{.Size }}{{end }}" ) - 1 ))\n$ subgidSize=$(( $(podman info --format "{{ range \\\n   .Host.IDMappings.GIDMap }}+{{.Size }}{{end }}" ) - 1 ))\n$ podman run --rm \\\n  --user $uid:$gid \\\n  --uidmap 0:1:$uid \\\n  --uidmap $uid:0:1 \\\n  --uidmap $(($uid+1)):$(($uid+1)):$(($subuidSize-$uid)) \\\n  --gidmap 0:1:$gid \\\n  --gidmap $gid:0:1 \\\n  --gidmap $(($gid+1)):$(($gid+1)):$(($subgidSize-$gid)) \\\n     docker.io/library/ubuntu /bin/cat /proc/self/uid_map\n         0          1       1000\n      1000          0          1\n      1001       1001      64536\n')),(0,a.kt)("p",null,"which uses the same UID and GID mapping as when specifying\n",(0,a.kt)("inlineCode",{parentName:"p"},"--userns keep-id:uid=$uid,gid=$gid")," with Podman 4.3.0 (or greater)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ uid=1000\n$ gid=1000\n$ podman run --rm \\\n  --user $uid:$gid \\\n  --userns keep-id:uid=$uid,gid=$gid \\\n     docker.io/library/ubuntu /bin/cat /proc/self/uid_map\n         0          1       1000\n      1000          0          1\n      1001       1001      64536\n")),(0,a.kt)("p",null,"Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"/bin/cat /proc/self/uid_map")," with\n",(0,a.kt)("inlineCode",{parentName:"p"},"/bin/cat /proc/self/gid_map")," to show the GID mapping."),(0,a.kt)("h3",{id:"40-podman-fails-to-find-expected-image-with-error-locating-pulled-image-image-not-known"},'40) Podman fails to find expected image with "error locating pulled image", "image not known"'),(0,a.kt)("p",null,'When trying to do a Podman command that pulls an image from local storage or a remote repository,\nan error is raised saying "image not known" or "error locating pulled image". Even though the image\nhad been verified before the Podman command was invoked.'),(0,a.kt)("h4",{id:"symptom-36"},"Symptom"),(0,a.kt)("p",null,"After verifying that an image is in place either locally or on a remote repository, a Podman command\nreferencing that image will fail in a manner like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'# ls Containerfile\nFROM registry.access.redhat.com/ubi8-minimal:latest\nMAINTAINER Podman Community\nUSER root\n\n# podman build .\nSTEP 1/2: FROM registry.access.redhat.com/ubi8-minimal\nTrying to pull registry.access.redhat.com/ubi8-minimal:latest...\nGetting image source signatures\nChecking if image destination supports signatures\nCopying blob a6577091999b done\nCopying config abb1ba1bce done\nWriting manifest to image destination\nStoring signatures\nError: error creating build container: error locating pulled image "registry.access.redhat.com/ubi8-minimal:latest" name in containers storage: registry.access.redhat.com/ubi8-minimal:latest: image not known\n')),(0,a.kt)("h4",{id:"solution-37"},"Solution"),(0,a.kt)("p",null,"The general cause for this is a timing issue. To make Podman commands as\nefficient as possible, read and write locks are only established for critical\nsections within the code. When pulling an image from a repository, a copy of\nthat image is first written to local storage using a write lock. This lock is\nreleased before the image is then acquired/read. If another process does a\nharmful command such as ",(0,a.kt)("inlineCode",{parentName:"p"},"podman system prune --all")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"podman system reset"),"\nor ",(0,a.kt)("inlineCode",{parentName:"p"},"podman rmi --all"),", between the time the image is written and before the\nfirst process can acquire it, this type of ",(0,a.kt)("inlineCode",{parentName:"p"},"image not known")," error can arise."),(0,a.kt)("p",null,"The maintainers of Podman have considered heavier-duty locks to close this\ntiming window. However, the slowdown that all Podman commands would encounter\nwas not considered worth the cost of completely closing this small timing window."))}m.isMDXComponent=!0}}]);