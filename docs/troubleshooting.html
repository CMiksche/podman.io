<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-troubleshooting">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">troubleshooting | Podman</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://containers.github.io/docs/troubleshooting"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="troubleshooting | Podman"><meta data-rh="true" name="description" content="PODMAN logo"><meta data-rh="true" property="og:description" content="PODMAN logo"><link data-rh="true" rel="icon" href="/favicon.ico"><link data-rh="true" rel="canonical" href="https://containers.github.io/docs/troubleshooting"><link data-rh="true" rel="alternate" href="https://containers.github.io/docs/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://containers.github.io/docs/troubleshooting" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Podman RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Podman Atom Feed"><link rel="stylesheet" href="/assets/css/styles.78eb3435.css">
<link rel="preload" href="/assets/js/runtime~main.473d615d.js" as="script">
<link rel="preload" href="/assets/js/main.6b05015a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logos/optimized/podman-3-logo-95w-90h.webp" alt="Podman Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/logos/optimized/podman-3-logo-95w-90h.webp" alt="Podman Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">podman</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/features">Features</a><a class="navbar__item navbar__link" href="/get-started">Get Started</a><a class="navbar__item navbar__link" href="/community">Community</a><a href="https://blog.podman.io" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Development Blog</a><a class="navbar__item navbar__link" href="/docs/podman">Documentation</a><a href="https://github.com/containers/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>troubleshooting</h1></header><p><img loading="lazy" src="https://raw.githubusercontent.com/containers/common/main/logos/podman-logo-full-vert.png" alt="PODMAN logo" class="img_ev3q"></p><h1>Troubleshooting</h1><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="a-list-of-common-issues-and-solutions-for-podman">A list of common issues and solutions for Podman<a href="#a-list-of-common-issues-and-solutions-for-podman" class="hash-link" aria-label="Direct link to A list of common issues and solutions for Podman" title="Direct link to A list of common issues and solutions for Podman">​</a></h2><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-variety-of-issues---validate-version">1) Variety of issues - Validate Version<a href="#1-variety-of-issues---validate-version" class="hash-link" aria-label="Direct link to 1) Variety of issues - Validate Version" title="Direct link to 1) Variety of issues - Validate Version">​</a></h3><p>A large number of issues reported against Podman are often found to already be fixed
in more current versions of the project. Before reporting an issue, please verify the
version you are running with <code>podman version</code> and compare it to the latest release
documented on the top of Podman&#x27;s <a href="https://github.com/containers/podman/blob/main/README.md" target="_blank" rel="noopener noreferrer">README</a>.</p><p>If they differ, please update your version of PODMAN to the latest possible
and retry your command before reporting the issue.</p><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-cant-use-volume-mount-get-permission-denied">2) Can&#x27;t use volume mount, get permission denied<a href="#2-cant-use-volume-mount-get-permission-denied" class="hash-link" aria-label="Direct link to 2) Can&#x27;t use volume mount, get permission denied" title="Direct link to 2) Can&#x27;t use volume mount, get permission denied">​</a></h3><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -v ~/mycontent:/content fedora touch /content/file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch: cannot touch &#x27;/content/file&#x27;: Permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>This is sometimes caused by SELinux, and sometimes by user namespaces.</p><p>Labeling systems like SELinux require that proper labels are placed on volume
content mounted into a container. Without a label, the security system might
prevent the processes running inside the container from using the content. By
default, Podman does not change the labels set by the OS.</p><p>To change a label in the container context, you can add either of two suffixes
<strong>:z</strong> or <strong>:Z</strong> to the volume mount. These suffixes tell Podman to relabel file
objects on the shared volumes. The <strong>z</strong> option tells Podman that two containers
share the volume content. As a result, Podman labels the content with a shared
content label. Shared volume labels allow all containers to read/write content.
The <strong>Z</strong> option tells Podman to label the content with a private unshared label.
Only the current container can use a private volume.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -v ~/mycontent:/content:Z fedora touch /content/file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make sure the content is private for the container. Do not relabel system directories and content.
Relabeling system content might cause other confined services on your machine to fail. For these
types of containers we recommend having SELinux separation disabled. The option <code>--security-opt label=disable</code>
will disable SELinux separation for the container.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --security-opt label=disable -v ~:/home/user fedora touch /home/user/file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In cases where the container image runs as a specific, non-root user, though, the
solution is to fix the user namespace. This would include container images such as
the Jupyter Notebook image (which runs as &quot;jovyan&quot;) and the Postgres image (which runs
as &quot;postgres&quot;). In either case, use the <code>--userns</code> switch to map user namespaces,
most of the time by using the <strong>keep-id</strong> option.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -v &quot;$PWD&quot;:/home/jovyan/work --userns=keep-id jupyter/scipy-notebook</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-no-such-image-or-bare-keys-cannot-contain-">3) No such image or Bare keys cannot contain &#x27;:&#x27;<a href="#3-no-such-image-or-bare-keys-cannot-contain-" class="hash-link" aria-label="Direct link to 3) No such image or Bare keys cannot contain &#x27;:&#x27;" title="Direct link to 3) No such image or Bare keys cannot contain &#x27;:&#x27;">​</a></h3><p>When doing a <code>podman pull</code> or <code>podman build</code> command and a &quot;common&quot; image cannot be pulled,
it is likely that the <code>/etc/containers/registries.conf</code> file is either not installed or possibly
misconfigured.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom">Symptom<a href="#symptom" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo podman build -f Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STEP 1: FROM alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error building: error creating build container: no such image &quot;alpine&quot; in registry: image not known</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo podman pull fedora</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error pulling image &quot;fedora&quot;: unable to pull fedora: error getting default registries to try: Near line 9 (last key parsed &#x27;&#x27;): Bare keys cannot contain &#x27;:&#x27;.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-1">Solution<a href="#solution-1" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><ul><li>Verify that the <code>/etc/containers/registries.conf</code> file exists. If not, verify that the containers-common package is installed.</li><li>Verify that the entries in the <code>unqualified-search-registries</code> list of the <code>/etc/containers/registries.conf</code> file are valid and reachable.<ul><li>i.e. <code>unqualified-search-registries = [&quot;registry.fedoraproject.org&quot;, &quot;quay.io&quot;, &quot;registry.access.redhat.com&quot;]</code></li></ul></li></ul><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-http-server-gave-http-response-to-https-client">4) http: server gave HTTP response to HTTPS client<a href="#4-http-server-gave-http-response-to-https-client" class="hash-link" aria-label="Direct link to 4) http: server gave HTTP response to HTTPS client" title="Direct link to 4) http: server gave HTTP response to HTTPS client">​</a></h3><p>When doing a Podman command such as <code>build</code>, <code>commit</code>, <code>pull</code>, or <code>push</code> to a registry,
TLS verification is turned on by default. If encryption is not used with
those commands, this error can occur.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-1">Symptom<a href="#symptom-1" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo podman push alpine docker://localhost:5000/myalpine:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Getting image source signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Get https://localhost:5000/v2/: http: server gave HTTP response to HTTPS client</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-2">Solution<a href="#solution-2" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>By default TLS verification is turned on when communicating to registries from
Podman. If the registry does not require encryption the Podman commands
such as <code>build</code>, <code>commit</code>, <code>pull</code> and <code>push</code> will fail unless TLS verification is turned
off using the <code>--tls-verify</code> option. <strong>NOTE:</strong> It is not at all recommended to
communicate with a registry and not use TLS verification.</p><ul><li>Turn off TLS verification by passing false to the tls-verify option.</li><li>I.e. <code>podman push --tls-verify=false alpine docker://localhost:5000/myalpine:latest</code></li></ul><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-rootless-containers-cannot-ping-hosts">5) rootless containers cannot ping hosts<a href="#5-rootless-containers-cannot-ping-hosts" class="hash-link" aria-label="Direct link to 5) rootless containers cannot ping hosts" title="Direct link to 5) rootless containers cannot ping hosts">​</a></h3><p>When using the ping command from a non-root container, the command may
fail because of a lack of privileges.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-2">Symptom<a href="#symptom-2" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm fedora ping -W10 -c1 redhat.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PING redhat.com (209.132.183.105): 56 data bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- redhat.com ping statistics ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 packets transmitted, 0 packets received, 100% packet loss</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-3">Solution<a href="#solution-3" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>It is most likely necessary to enable unprivileged pings on the host.
Be sure the UID of the user is part of the range in the
<code>/proc/sys/net/ipv4/ping_group_range</code> file.</p><p>To change its value you can use something like:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># sysctl -w &quot;net.ipv4.ping_group_range=0 2000000&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To make the change persistent, you&#x27;ll need to add a file in
<code>/etc/sysctl.d</code> that contains <code>net.ipv4.ping_group_range=0 $MAX_UID</code>.</p><hr><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-build-hangs-when-the-dockerfile-contains-the-useradd-command">6) Build hangs when the Dockerfile contains the useradd command<a href="#6-build-hangs-when-the-dockerfile-contains-the-useradd-command" class="hash-link" aria-label="Direct link to 6) Build hangs when the Dockerfile contains the useradd command" title="Direct link to 6) Build hangs when the Dockerfile contains the useradd command">​</a></h3><p>When the Dockerfile contains a command like <code>RUN useradd -u 99999000 -g users newuser</code> the build can hang.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-3">Symptom<a href="#symptom-3" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>If you are using a useradd command within a Dockerfile with a large UID/GID, it will create a large sparse file <code>/var/log/lastlog</code>. This can cause the build to hang forever. Go language does not support sparse files correctly, which can lead to some huge files being created in your container image.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-4">Solution<a href="#solution-4" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>If the entry in the Dockerfile looked like: RUN useradd -u 99999000 -g users newuser then add the <code>--no-log-init</code> parameter to change it to: <code>RUN useradd --no-log-init -u 99999000 -g users newuser</code>. This option tells useradd to stop creating the lastlog file.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-permission-denied-when-running-podman-commands">7) Permission denied when running Podman commands<a href="#7-permission-denied-when-running-podman-commands" class="hash-link" aria-label="Direct link to 7) Permission denied when running Podman commands" title="Direct link to 7) Permission denied when running Podman commands">​</a></h3><p>When rootless Podman attempts to execute a container on a non exec home directory a permission error will be raised.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-4">Symptom<a href="#symptom-4" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>If you are running Podman or Buildah on a home directory that is mounted noexec,
then they will fail with a message like:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run centos:7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">standard_init_linux.go:203: exec user process caused &quot;permission denied&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-5">Solution<a href="#solution-5" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Since the administrator of the system set up your home directory to be noexec, you will not be allowed to execute containers from storage in your home directory. It is possible to work around this by manually specifying a container storage path that is not on a noexec mount. Simply copy the file /etc/containers/storage.conf to ~/.config/containers/ (creating the directory if necessary). Specify a graphroot directory which is not on a noexec mount point and to which you have read/write privileges. You will need to modify other fields to writable directories as well.</p><p>For example</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat ~/.config/containers/storage.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[storage]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  driver = &quot;overlay&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runroot = &quot;/run/user/1000&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  graphroot = &quot;/execdir/myuser/storage&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [storage.options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mount_program = &quot;/bin/fuse-overlayfs&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-permission-denied-when-running-systemd-within-a-podman-container">8) Permission denied when running systemd within a Podman container<a href="#8-permission-denied-when-running-systemd-within-a-podman-container" class="hash-link" aria-label="Direct link to 8) Permission denied when running systemd within a Podman container" title="Direct link to 8) Permission denied when running systemd within a Podman container">​</a></h3><p>When running systemd as PID 1 inside of a container on an SELinux
separated machine, it needs to write to the cgroup file system.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-5">Symptom<a href="#symptom-5" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Systemd gets permission denied when attempting to write to the cgroup file
system, and AVC messages start to show up in the audit.log file or journal on
the system.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-6">Solution<a href="#solution-6" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Newer versions of Podman (2.0 or greater) support running init based containers
with a different SELinux labels, which allow the container process access to the
cgroup file system. This feature requires container-selinux-2.132 or newer
versions.</p><p>Prior to Podman 2.0, the SELinux boolean <code>container_manage_cgroup</code> allows
container processes to write to the cgroup file system. Turn on this boolean,
on SELinux separated systems, to allow systemd to run properly in the container.
Only do this on systems running older versions of Podman.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># setsebool -P container_manage_cgroup true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-newuidmap-missing-when-running-rootless-podman-commands">9) Newuidmap missing when running rootless Podman commands<a href="#9-newuidmap-missing-when-running-rootless-podman-commands" class="hash-link" aria-label="Direct link to 9) Newuidmap missing when running rootless Podman commands" title="Direct link to 9) Newuidmap missing when running rootless Podman commands">​</a></h3><p>Rootless Podman requires the newuidmap and newgidmap programs to be installed.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-6">Symptom<a href="#symptom-6" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>If you are running Podman or Buildah as a rootless user, you get an error complaining about
a missing newuidmap executable.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -ti fedora sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">command required for rootless mode with multiple IDs: exec: &quot;newuidmap&quot;: executable file not found in $PATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-7">Solution<a href="#solution-7" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Install a version of shadow-utils that includes these executables. Note that for RHEL and CentOS 7, at least the 7.7 release must be installed for support to be available.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10-rootless-setup-user-invalid-argument">10) rootless setup user: invalid argument<a href="#10-rootless-setup-user-invalid-argument" class="hash-link" aria-label="Direct link to 10) rootless setup user: invalid argument" title="Direct link to 10) rootless setup user: invalid argument">​</a></h3><p>Rootless Podman requires the user running it to have a range of UIDs listed in /etc/subuid and /etc/subgid.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-7">Symptom<a href="#symptom-7" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>A user, either via --user or through the default configured for the image, is not mapped inside the namespace.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -ti --user 1000000 alpine echo hi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: container create failed: container_linux.go:344: starting container process caused &quot;setup user: invalid argument&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-8">Solution<a href="#solution-8" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Update the /etc/subuid and /etc/subgid with fields for users that look like:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat /etc/subuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">johndoe:100000:65536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test:165536:65536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The format of this file is <code>USERNAME:UID:RANGE</code></p><ul><li>username as listed in <code>/etc/passwd</code> or <code>getpwent</code>.</li><li>The initial uid allocated for the user.</li><li>The size of the range of UIDs allocated for the user.</li></ul><p>This means johndoe is allocated UIDs 100000-165535 as well as his standard UID in the
<code>/etc/passwd</code> file.</p><p>You should ensure that each user has a unique range of UIDs, because overlapping UIDs,
would potentially allow one user to attack another user. In addition, make sure
that the range of UIDs you allocate can cover all UIDs that the container
requires. For example, if the container has a user with UID 10000, ensure you
have at least 10001 subuids, and if the container needs to be run as a user with
UID 1000000, ensure you have at least 1000001 subuids.</p><p>You could also use the <code>usermod</code> program to assign UIDs to a user.</p><p>If you update either the <code>/etc/subuid</code> or <code>/etc/subgid</code> file, you need to
stop all running containers and kill the pause process. This is done
automatically by the <code>system migrate</code> command, which can also be used
to stop all the containers and kill the pause process.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># usermod --add-subuids 200000-201000 --add-subgids 200000-201000 johndoe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># grep johndoe /etc/subuid /etc/subgid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/subuid:johndoe:200000:1001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/subgid:johndoe:200000:1001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-changing-the-location-of-the-graphroot-leads-to-permission-denied">11) Changing the location of the Graphroot leads to permission denied<a href="#11-changing-the-location-of-the-graphroot-leads-to-permission-denied" class="hash-link" aria-label="Direct link to 11) Changing the location of the Graphroot leads to permission denied" title="Direct link to 11) Changing the location of the Graphroot leads to permission denied">​</a></h3><p>When I change the graphroot storage location in storage.conf, the next time I
run Podman, I get an error like:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># podman run -p 5000:5000 -it centos bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bash: error while loading shared libraries: /lib64/libc.so.6: cannot apply additional memory protection after relocation: Permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For example, the admin sets up a spare disk to be mounted at <code>/src/containers</code>,
and points storage.conf at this directory.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-8">Symptom<a href="#symptom-8" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>SELinux blocks containers from using arbitrary locations for overlay storage.
These directories need to be labeled with the same labels as if the content was
under <code>/var/lib/containers/storage</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-9">Solution<a href="#solution-9" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Tell SELinux about the new containers storage by setting up an equivalence record.
This tells SELinux to label content under the new path, as if it was stored
under <code>/var/lib/containers/storage</code>.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># semanage fcontext -a -e /var/lib/containers /srv/containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># restorecon -R -v /srv/containers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The semanage command above tells SELinux to set up the default labeling of
<code>/srv/containers</code> to match <code>/var/lib/containers</code>. The <code>restorecon</code> command
tells SELinux to apply the labels to the actual content.</p><p>Now all new content created in these directories will automatically be created
with the correct label.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-anonymous-image-pull-fails-with-invalid-usernamepassword">12) Anonymous image pull fails with &#x27;invalid username/password&#x27;<a href="#12-anonymous-image-pull-fails-with-invalid-usernamepassword" class="hash-link" aria-label="Direct link to 12) Anonymous image pull fails with &#x27;invalid username/password&#x27;" title="Direct link to 12) Anonymous image pull fails with &#x27;invalid username/password&#x27;">​</a></h3><p>Pulling an anonymous image that doesn&#x27;t require authentication can result in an
<code>invalid username/password</code> error.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-9">Symptom<a href="#symptom-9" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>If you pull an anonymous image, one that should not require credentials, you can receive
an <code>invalid username/password</code> error if you have credentials established in the
authentication file for the target container registry that are no longer valid.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -it --rm docker://docker.io/library/alpine:latest ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trying to pull docker://docker.io/library/alpine:latest...ERRO[0000] Error pulling image ref //alpine:latest: Error determining manifest MIME type for docker://alpine:latest: unable to retrieve auth token: invalid username/password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: unable to pull docker://docker.io/library/alpine:latest: unable to pull image: Error determining manifest MIME type for docker://alpine:latest: unable to retrieve auth token: invalid username/password</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This can happen if the authentication file is modified &#x27;by hand&#x27; or if the credentials
are established locally and then the password is updated later in the container registry.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-10">Solution<a href="#solution-10" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Depending upon which container tool was used to establish the credentials, use <code>podman logout</code>
or <code>docker logout</code> to remove the credentials from the authentication file.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13-running-podman-inside-a-container-causes-container-crashes-and-inconsistent-states">13) Running Podman inside a container causes container crashes and inconsistent states<a href="#13-running-podman-inside-a-container-causes-container-crashes-and-inconsistent-states" class="hash-link" aria-label="Direct link to 13) Running Podman inside a container causes container crashes and inconsistent states" title="Direct link to 13) Running Podman inside a container causes container crashes and inconsistent states">​</a></h3><p>Running Podman in a container and forwarding some, but not all, of the required host directories can cause inconsistent container behavior.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-10">Symptom<a href="#symptom-10" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>After creating a container with Podman&#x27;s storage directories mounted in from the host and running Podman inside a container, all containers show their state as &quot;configured&quot; or &quot;created&quot;, even if they were running or stopped.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-11">Solution<a href="#solution-11" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>When running Podman inside a container, it is recommended to mount at a minimum <code>/var/lib/containers/storage/</code> as a volume.
Typically, you will not mount in the host version of the directory, but if you wish to share containers with the host, you can do so.
If you do mount in the host&#x27;s <code>/var/lib/containers/storage</code>, however, you must also mount in the host&#x27;s <code>/run/libpod</code> and <code>/run/containers/storage</code> directories.
Not doing this will cause Podman in the container to detect that temporary files have been cleared, leading it to assume a system restart has taken place.
This can cause Podman to reset container states and lose track of running containers.</p><p>For running containers on the host from inside a container, we also recommend the <a href="/docs/tutorials/remote_client">Podman remote client</a>, which only requires a single socket to be mounted into the container.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="14-rootless-podman-build-fails-eperm-on-nfs">14) Rootless &#x27;podman build&#x27; fails EPERM on NFS:<a href="#14-rootless-podman-build-fails-eperm-on-nfs" class="hash-link" aria-label="Direct link to 14) Rootless &#x27;podman build&#x27; fails EPERM on NFS:" title="Direct link to 14) Rootless &#x27;podman build&#x27; fails EPERM on NFS:">​</a></h3><p>NFS enforces file creation on different UIDs on the server side and does not understand user namespace, which rootless Podman requires.
When a container root process like YUM attempts to create a file owned by a different UID, NFS Server denies the creation.
NFS is also a problem for the file locks when the storage is on it. Other distributed file systems (for example: Lustre, Spectrum Scale, the General Parallel File System (GPFS)) are also not supported when running in rootless mode as these file systems do not understand user namespace.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-11">Symptom<a href="#symptom-11" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman build .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERRO[0014] Error while applying layer: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error creating build container: Error committing the finished image: error adding layer with blob &quot;sha256:a02a4930cb5d36f3290eb84f4bfa30668ef2e9fe3a1fb73ec015fc58b9958b17&quot;: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-12">Solution<a href="#solution-12" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Choose one of the following:</p><ul><li>Set up containers/storage in a different directory, not on an NFS share.<ul><li>Create a directory on a local file system.</li><li>Edit <code>~/.config/containers/containers.conf</code> and point the <code>volume_path</code> option to that local directory. (Copy <code>/usr/share/containers/containers.conf</code> if <code>~/.config/containers/containers.conf</code> does not exist)</li></ul></li><li>Otherwise just run Podman as root, via <code>sudo podman</code></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="15-rootless-podman-build-fails-when-using-overlayfs">15) Rootless &#x27;podman build&#x27; fails when using OverlayFS:<a href="#15-rootless-podman-build-fails-when-using-overlayfs" class="hash-link" aria-label="Direct link to 15) Rootless &#x27;podman build&#x27; fails when using OverlayFS:" title="Direct link to 15) Rootless &#x27;podman build&#x27; fails when using OverlayFS:">​</a></h3><p>The Overlay file system (OverlayFS) requires the ability to call the <code>mknod</code> command when creating whiteout files
when extracting an image. However, a rootless user does not have the privileges to use <code>mknod</code> in this capacity.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-12">Symptom<a href="#symptom-12" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman build --storage-driver overlay .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STEP 1: FROM docker.io/ubuntu:xenial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Getting image source signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying blob edf72af6d627 done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying blob 3e4f86211d23 done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying blob 8d3eac894db4 done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying blob f7277927d38a done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying config 5e13f8dd4c done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing manifest to image destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Storing signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating build container: Error committing the finished image: error adding layer with blob &quot;sha256:8d3eac894db4dc4154377ad28643dfe6625ff0e54bcfa63e0d04921f1a8ef7f8&quot;: Error processing tar file(exit status 1): operation not permitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman build .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERRO[0014] Error while applying layer: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error creating build container: Error committing the finished image: error adding layer with blob &quot;sha256:a02a4930cb5d36f3290eb84f4bfa30668ef2e9fe3a1fb73ec015fc58b9958b17&quot;: ApplyLayer exit status 1 stdout:  stderr: open /root/.bash_logout: permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-13">Solution<a href="#solution-13" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Choose one of the following:</p><ul><li>Complete the build operation as a privileged user.</li><li>Install and configure fuse-overlayfs.<ul><li>Install the fuse-overlayfs package for your Linux Distribution.</li><li>Add <code>mount_program = &quot;/usr/bin/fuse-overlayfs&quot;</code> under <code>[storage.options]</code> in your <code>~/.config/containers/storage.conf</code> file.</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2">16) RHEL 7 and CentOS 7 based <code>init</code> images don&#x27;t work with cgroup v2<a href="#16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2" class="hash-link" aria-label="Direct link to 16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2" title="Direct link to 16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2">​</a></h3><p>The systemd version shipped in RHEL 7 and CentOS 7 doesn&#x27;t have support for cgroup v2. Support for cgroup v2 requires version 230 of systemd or newer, which
was never shipped or supported on RHEL 7 or CentOS 7.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-13">Symptom<a href="#symptom-13" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># podman run --name test -d registry.access.redhat.com/rhel7-init:latest &amp;&amp; sleep 10 &amp;&amp; podman exec test systemctl status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c8567461948439bce72fad3076a91ececfb7b14d469bfa5fbc32c6403185beff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed to get D-Bus connection: Operation not permitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: non zero exit code: 1: OCI runtime error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-14">Solution<a href="#solution-14" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>You&#x27;ll need to either:</p><ul><li>configure the host to use cgroup v1. On Fedora you can do:</li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install -y grubby</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># grubby --update-kernel=ALL --args=”systemd.unified_cgroup_hierarchy=0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>update the image to use an updated version of systemd.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="17-rootless-containers-exit-once-the-user-session-exits">17) rootless containers exit once the user session exits<a href="#17-rootless-containers-exit-once-the-user-session-exits" class="hash-link" aria-label="Direct link to 17) rootless containers exit once the user session exits" title="Direct link to 17) rootless containers exit once the user session exits">​</a></h3><p>You need to set lingering mode through loginctl to prevent user processes to be killed once
the user session completed.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-14">Symptom<a href="#symptom-14" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Once the user logs out all the containers exit.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-15">Solution<a href="#solution-15" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>You&#x27;ll need to either:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># loginctl enable-linger $UID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="18-podman-run-fails-with-bpf-create-permission-denied-error">18) <code>podman run</code> fails with &quot;bpf create: permission denied error&quot;<a href="#18-podman-run-fails-with-bpf-create-permission-denied-error" class="hash-link" aria-label="Direct link to 18-podman-run-fails-with-bpf-create-permission-denied-error" title="Direct link to 18-podman-run-fails-with-bpf-create-permission-denied-error">​</a></h3><p>The Kernel Lockdown patches deny eBPF programs when Secure Boot is enabled in the BIOS. <a href="https://mjg59.dreamwidth.org/50577.html" target="_blank" rel="noopener noreferrer">Matthew Garrett&#x27;s post</a> describes the relationship between Lockdown and Secure Boot and <a href="https://gehrcke.de/2019/09/running-an-ebpf-program-may-require-lifting-the-kernel-lockdown/" target="_blank" rel="noopener noreferrer">Jan-Philip Gehrcke&#x27;s</a> connects this with eBPF. <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1768125" target="_blank" rel="noopener noreferrer">RH bug 1768125</a> contains some additional details.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-15">Symptom<a href="#symptom-15" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Attempts to run podman result in</p><p><code>Error: bpf create : Operation not permitted: OCI runtime permission denied error</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-16">Solution<a href="#solution-16" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>One workaround is to disable Secure Boot in your BIOS.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="19-error-creating-libpod-runtime-there-might-not-be-enough-ids-available-in-the-namespace">19) error creating libpod runtime: there might not be enough IDs available in the namespace<a href="#19-error-creating-libpod-runtime-there-might-not-be-enough-ids-available-in-the-namespace" class="hash-link" aria-label="Direct link to 19) error creating libpod runtime: there might not be enough IDs available in the namespace" title="Direct link to 19) error creating libpod runtime: there might not be enough IDs available in the namespace">​</a></h3><p>Unable to pull images</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-16">Symptom<a href="#symptom-16" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman unshare cat /proc/self/uid_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     0       1000          1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-17">Solution<a href="#solution-17" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman system migrate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Original command now returns</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman unshare cat /proc/self/uid_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     0       1000          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     1     100000      65536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Reference <a href="https://man7.org/linux/man-pages/man5/subuid.5.html" target="_blank" rel="noopener noreferrer">subuid</a> and <a href="https://man7.org/linux/man-pages/man5/subgid.5.html" target="_blank" rel="noopener noreferrer">subgid</a> man pages for more detail.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="20-passed-in-devices-or-files-cant-be-accessed-in-rootless-container">20) Passed-in devices or files can&#x27;t be accessed in rootless container<a href="#20-passed-in-devices-or-files-cant-be-accessed-in-rootless-container" class="hash-link" aria-label="Direct link to 20) Passed-in devices or files can&#x27;t be accessed in rootless container" title="Direct link to 20) Passed-in devices or files can&#x27;t be accessed in rootless container">​</a></h3><p>As a non-root user you have group access rights to a device or files that you
want to pass into a rootless container with <code>--device=...</code> or <code>--volume=...</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-17">Symptom<a href="#symptom-17" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Any access inside the container is rejected with &quot;Permission denied&quot;.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-18">Solution<a href="#solution-18" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>The runtime uses <code>setgroups(2)</code> hence the process loses all additional groups
the non-root user has. Use the <code>--group-add keep-groups</code> flag to pass the
user&#x27;s supplementary group access into the container. Currently only available
with the <code>crun</code> OCI runtime.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-a-rootless-container-running-in-detached-mode-is-closed-at-logout">21) A rootless container running in detached mode is closed at logout<a href="#21-a-rootless-container-running-in-detached-mode-is-closed-at-logout" class="hash-link" aria-label="Direct link to 21) A rootless container running in detached mode is closed at logout" title="Direct link to 21) A rootless container running in detached mode is closed at logout">​</a></h3><p>When running a container with a command like <code>podman run --detach httpd</code> as
a rootless user, the container is closed upon logout and is not kept running.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-18">Symptom<a href="#symptom-18" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>When logging out of a rootless user session, all containers that were started
in detached mode are stopped and are not kept running. As the root user, these
same containers would survive the logout and continue running.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-19">Solution<a href="#solution-19" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>When systemd notes that a session that started a Podman container has exited,
it will also stop any containers that have been associated with it. To avoid
this, use the following command before logging out: <code>loginctl enable-linger</code>.
To later revert the linger functionality, use <code>loginctl disable-linger</code>.</p><p>LOGINCTL(1), SYSTEMD(1)</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-containers-default-detach-keys-conflict-with-shell-history-navigation">22) Containers default detach keys conflict with shell history navigation<a href="#22-containers-default-detach-keys-conflict-with-shell-history-navigation" class="hash-link" aria-label="Direct link to 22) Containers default detach keys conflict with shell history navigation" title="Direct link to 22) Containers default detach keys conflict with shell history navigation">​</a></h3><p>Podman defaults to <code>ctrl-p,ctrl-q</code> to detach from a running containers. The
bash and zsh shells default to <code>ctrl-p</code> for the displaying of the previous
command. This causes issues when running a shell inside of a container.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-19">Symptom<a href="#symptom-19" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>With the default detach key combo ctrl-p,ctrl-q, shell history navigation
(tested in bash and zsh) using ctrl-p to access the previous command will not
display this previous command, or anything else. Conmon is waiting for an
additional character to see if the user wants to detach from the container.
Adding additional characters to the command will cause it to be displayed along
with the additional character. If the user types ctrl-p a second time the shell
display the 2nd to last command.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-20">Solution<a href="#solution-20" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>The solution to this is to change the default detach_keys. For example in order
to change the defaults to <code>ctrl-q,ctrl-q</code> use the <code>--detach-keys</code> option.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run -ti --detach-keys ctrl-q,ctrl-q fedora sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To make this change the default for all containers, users can modify the
containers.conf file. This can be done simply in your home directory, but adding the
following lines to users containers.conf</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat &gt;&gt; ~/.config/containers/containers.conf &lt;&lt; _eof</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[engine]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">detach_keys=&quot;ctrl-q,ctrl-q&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_eof</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to effect root running containers and all users, modify the system
wide defaults in <code>/etc/containers/containers.conf</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23-container-with-exposed-ports-wont-run-in-a-pod">23) Container with exposed ports won&#x27;t run in a pod<a href="#23-container-with-exposed-ports-wont-run-in-a-pod" class="hash-link" aria-label="Direct link to 23) Container with exposed ports won&#x27;t run in a pod" title="Direct link to 23) Container with exposed ports won&#x27;t run in a pod">​</a></h3><p>A container with ports that have been published with the <code>--publish</code> or <code>-p</code> option
can not be run within a pod.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-20">Symptom<a href="#symptom-20" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman pod create --name srcview -p 127.0.0.1:3434:3434 -p 127.0.0.1:7080:7080 -p 127.0.0.1:3370:3370                        4b2f4611fa2cbd60b3899b936368c2b3f4f0f68bc8e6593416e0ab8ecb0a3f1d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --pod srcview --name src-expose -p 3434:3434 -v &quot;${PWD}:/var/opt/localrepo&quot;:Z,ro sourcegraph/src-expose:latest serve /var/opt/localrepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: cannot set port bindings on an existing container network namespace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-21">Solution<a href="#solution-21" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>This is a known limitation. If a container will be run within a pod, it is not necessary
to publish the port for the containers in the pod. The port must only be published by the
pod itself. Pod network stacks act like the network stack on the host - you have a
variety of containers in the pod, and programs in the container, all sharing a single
interface and IP address, and associated ports. If one container binds to a port, no other
container can use that port within the pod while it is in use. Containers in the pod can
also communicate over localhost by having one container bind to localhost in the pod, and
another connect to that port.</p><p>In the example from the symptom section, dropping the <code>-p 3434:3434</code> would allow the
<code>podman run</code> command to complete, and the container as part of the pod would still have
access to that port. For example:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --pod srcview --name src-expose -v &quot;${PWD}:/var/opt/localrepo&quot;:Z,ro sourcegraph/src-expose:latest serve /var/opt/localrepo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="24-podman-container-images-fail-with-fuse-device-not-found-when-run">24) Podman container images fail with <code>fuse: device not found</code> when run<a href="#24-podman-container-images-fail-with-fuse-device-not-found-when-run" class="hash-link" aria-label="Direct link to 24-podman-container-images-fail-with-fuse-device-not-found-when-run" title="Direct link to 24-podman-container-images-fail-with-fuse-device-not-found-when-run">​</a></h3><p>Some container images require that the fuse kernel module is loaded in the kernel
before they will run with the fuse filesystem in play.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-21">Symptom<a href="#symptom-21" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>When trying to run the container images found at quay.io/podman, quay.io/containers
registry.access.redhat.com/ubi8 or other locations, an error will sometimes be returned:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ERRO error unmounting /var/lib/containers/storage/overlay/30c058cdadc888177361dd14a7ed7edab441c58525b341df321f07bc11440e68/merged: invalid argument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error mounting container &quot;1ae176ca72b3da7c70af31db7434bcf6f94b07dbc0328bc7e4e8fc9579d0dc2e&quot;: error mounting build container &quot;1ae176ca72b3da7c70af31db7434bcf6f94b07dbc0328bc7e4e8fc9579d0dc2e&quot;: error creating overlay mount to /var/lib/containers/storage/overlay/30c058cdadc888177361dd14a7ed7edab441c58525b341df321f07bc11440e68/merged: using mount program /usr/bin/fuse-overlayfs: fuse: device not found, try &#x27;modprobe fuse&#x27; first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fuse-overlayfs: cannot mount: No such device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: exit status 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERRO exit status 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-22">Solution<a href="#solution-22" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>If you encounter a <code>fuse: device not found</code> error when running the container image, it is likely that
the fuse kernel module has not been loaded on your host system. Use the command <code>modprobe fuse</code> to load the
module and then run the container image afterwards. To enable this automatically at boot time, you can add a configuration
file to <code>/etc/modules.load.d</code>. See <code>man modules-load.d</code> for more details.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="25-podman-run---rootfs-linktoreadonlydir-does-not-work">25) podman run --rootfs link/to//read/only/dir does not work<a href="#25-podman-run---rootfs-linktoreadonlydir-does-not-work" class="hash-link" aria-label="Direct link to 25) podman run --rootfs link/to//read/only/dir does not work" title="Direct link to 25) podman run --rootfs link/to//read/only/dir does not work">​</a></h3><p>An error such as &quot;OCI runtime error&quot; on a read-only filesystem or the error &quot;{image} is not an absolute path or is a symlink&quot; are often times indicators for this issue. For more details, review this <a href="https://github.com/containers/podman/issues/5895" target="_blank" rel="noopener noreferrer">issue</a>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-22">Symptom<a href="#symptom-22" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Rootless Podman requires certain files to exist in a file system in order to run.
Podman will create /etc/resolv.conf, /etc/hosts and other file descriptors on the rootfs in order
to mount volumes on them.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-23">Solution<a href="#solution-23" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Run the container once in read/write mode, Podman will generate all of the FDs on the rootfs, and
from that point forward you can run with a read-only rootfs.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm --rootfs /path/to/rootfs true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The command above will create all the missing directories needed to run the container.</p><p>After that, it can be used in read-only mode, by multiple containers at the same time:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --read-only --rootfs /path/to/rootfs ....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another option is to use an Overlay Rootfs Mount:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rootfs /path/to/rootfs:O ....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Modifications to the mount point are destroyed when the container
finishes executing, similar to a tmpfs mount point being unmounted.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="26-running-containers-with-resource-limits-fails-with-a-permissions-error">26) Running containers with resource limits fails with a permissions error<a href="#26-running-containers-with-resource-limits-fails-with-a-permissions-error" class="hash-link" aria-label="Direct link to 26) Running containers with resource limits fails with a permissions error" title="Direct link to 26) Running containers with resource limits fails with a permissions error">​</a></h3><p>On some systemd-based systems, non-root users do not have resource limit delegation
permissions. This causes setting resource limits to fail.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-23">Symptom<a href="#symptom-23" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>Running a container with a resource limit options will fail with an error similar to the following:</p><p><code>--cpus</code>, <code>--cpu-period</code>, <code>--cpu-quota</code>, <code>--cpu-shares</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error: OCI runtime error: crun: the requested cgroup controller `cpu` is not available</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>--cpuset-cpus</code>, <code>--cpuset-mems</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error: OCI runtime error: crun: the requested cgroup controller `cpuset` is not available</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This means that resource limit delegation is not enabled for the current user.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-24">Solution<a href="#solution-24" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>You can verify whether resource limit delegation is enabled by running the following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat &quot;/sys/fs/cgroup/user.slice/user-$(id -u).slice/user@$(id -u).service/cgroup.controllers&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example output might be:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">memory pids</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above example, <code>cpu</code> and <code>cpuset</code> are not listed, which means the current user does
not have permission to set CPU or CPUSET limits.</p><p>If you want to enable CPU or CPUSET limit delegation for all users, you can create the
file <code>/etc/systemd/system/user@.service.d/delegate.conf</code> with the contents:</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Delegate=memory pids cpu cpuset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After logging out and logging back in, you should have permission to set
CPU and CPUSET limits.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh">27) <code>exec container process &#x27;/bin/sh&#x27;: Exec format error</code> (or another binary than <code>bin/sh</code>)<a href="#27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh" class="hash-link" aria-label="Direct link to 27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh" title="Direct link to 27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh">​</a></h3><p>This can happen when running a container from an image for another architecture than the one you are running on.</p><p>For example, if a remote repository only has, and thus send you, a <code>linux/arm64</code> <em>OS/ARCH</em> but you run on <code>linux/amd64</code> (as happened in <a href="https://github.com/openMF/community-app/issues/3323" target="_blank" rel="noopener noreferrer">https://github.com/openMF/community-app/issues/3323</a> due to <a href="https://github.com/timbru31/docker-ruby-node/issues/564" target="_blank" rel="noopener noreferrer">https://github.com/timbru31/docker-ruby-node/issues/564</a>).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain">28) <code>Error: failed to create sshClient: Connection to bastion host (ssh://user@host:22/run/user/.../podman/podman.sock) failed.: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain</code><a href="#28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain" class="hash-link" aria-label="Direct link to 28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain" title="Direct link to 28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain">​</a></h3><p>In some situations where the client is not on the same machine as where the podman daemon is running the client key could be using a cipher not supported by the host. This indicates an issue with one&#x27;s SSH config. Until remedied using podman over ssh
with a pre-shared key will be impossible.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-24">Symptom<a href="#symptom-24" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>The accepted ciphers per <code>/etc/crypto-policies/back-ends/openssh.config</code> are not one that was used to create the public/private key pair that was transferred over to the host for ssh authentication.</p><p>You can confirm this is the case by attempting to connect to the host via <code>podman-remote info</code> from the client and simultaneously on the host running <code>journalctl -f</code> and watching for the error <code>userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]</code>.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-25">Solution<a href="#solution-25" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Create a new key using a supported algorithm e.g. ecdsa:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-keygen -t ecdsa -f ~/.ssh/podman</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then copy the new id over:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-copy-id -i ~/.ssh/podman.pub user@host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then re-add the connection (removing the old one if necessary):</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman-remote system connection add myuser --identity ~/.ssh/podman ssh://user@host/run/user/1000/podman/podman.sock</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And now this should work:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman-remote info</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="29-rootless-cni-networking-fails-in-rhel-with-podman-v221-to-v301">29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1.<a href="#29-rootless-cni-networking-fails-in-rhel-with-podman-v221-to-v301" class="hash-link" aria-label="Direct link to 29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1." title="Direct link to 29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1.">​</a></h3><p>A failure is encountered when trying to use networking on a rootless
container in Podman v2.2.1 through v3.0.1 on RHEL. This error does not
occur on other Linux distributions.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-25">Symptom<a href="#symptom-25" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>A rootless container is created using a CNI network, but the <code>podman run</code> command
returns an error that an image must be built.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-26">Solution<a href="#solution-26" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>In order to use a CNI network in a rootless container on RHEL,
an Infra container image for CNI-in-slirp4netns must be created. The
instructions for building the Infra container image can be found for
v2.2.1 <a href="https://github.com/containers/podman/tree/v2.2.1-rhel/contrib/rootless-cni-infra" target="_blank" rel="noopener noreferrer">here</a>,
and for v3.0.1 <a href="https://github.com/containers/podman/tree/v3.0.1-rhel/contrib/rootless-cni-infra" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="30-container-related-firewall-rules-are-lost-after-reloading-firewalld">30) Container related firewall rules are lost after reloading firewalld<a href="#30-container-related-firewall-rules-are-lost-after-reloading-firewalld" class="hash-link" aria-label="Direct link to 30) Container related firewall rules are lost after reloading firewalld" title="Direct link to 30) Container related firewall rules are lost after reloading firewalld">​</a></h3><p>Container network can&#x27;t be reached after <code>firewall-cmd --reload</code> and <code>systemctl restart firewalld</code> Running <code>podman network reload</code> will fix it but it has to be done manually.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-26">Symptom<a href="#symptom-26" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>The firewall rules created by podman are lost when the firewall is reloaded.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-27">Solution<a href="#solution-27" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p><a href="https://github.com/containers/podman/issues/5431#issuecomment-847758377" target="_blank" rel="noopener noreferrer">@ranjithrajaram</a> has created a systemd-hook to fix this issue</p><ol><li>For &quot;firewall-cmd --reload&quot;, create a systemd unit file with the following</li></ol><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=firewalld reload hook - run a hook script on firewalld reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/bin/bash -c &#x27;/bin/busctl monitor --system --match &quot;interface=org.fedoraproject.FirewallD1,member=Reloaded&quot; --match &quot;interface=org.fedoraproject.FirewallD1,member=PropertiesChanged&quot; | while read -r line ; do podman network reload --all ; done&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=default.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>For &quot;systemctl restart firewalld&quot;, create a systemd unit file with the following</li></ol><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=podman network reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PartOf=firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RemainAfterExit=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/bin/podman network reload --all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=default.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, If you use busctl monitor then you can&#x27;t get machine-readable output on RHEL 8.
Since it doesn&#x27;t have <code>busctl -j</code> as mentioned here by <a href="https://github.com/containers/podman/issues/5431#issuecomment-896943018" target="_blank" rel="noopener noreferrer">@yrro</a>.</p><p>For RHEL 8, you can use the following one-liner bash script.</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=Redo podman NAT rules after firewalld starts or reloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Requires=firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/bin/bash -c &quot;dbus-monitor --profile --system &#x27;type=signal,sender=org.freedesktop.DBus,path=/org/freedesktop/DBus,interface=org.freedesktop.DBus,member=NameAcquired,arg0=org.fedoraproject.FirewallD1&#x27; &#x27;type=signal,path=/org/fedoraproject/FirewallD1,interface=org.fedoraproject.FirewallD1,member=Reloaded&#x27; | sed -u &#x27;/^#/d&#x27; | while read -r type timestamp serial sender destination path interface member _junk; do if [[ $type = &#x27;#&#x27;* ]]; then continue; elif [[ $interface = org.freedesktop.DBus &amp;&amp; $member = NameAcquired ]]; then echo &#x27;firewalld started&#x27;; podman network reload --all; elif [[ $interface = org.fedoraproject.FirewallD1 &amp;&amp; $member = Reloaded ]]; then echo &#x27;firewalld reloaded&#x27;; podman network reload --all; fi; done&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=default.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>busctl-monitor</code> is almost usable in RHEL 8, except that it always outputs two bogus events when it starts up,
one of which is (in its only machine-readable format) indistinguishable from the <code>NameOwnerChanged</code> that you get when firewalld starts up.
This means you would get an extra <code>podman network reload --all</code> when this unit starts.</p><p>Apart from this, you can use the following systemd service with the python3 code.</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=Redo podman NAT rules after firewalld starts or reloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Requires=firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=dbus.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/bin/python  /path/to/python/code/podman-redo-nat.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=default.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code reloads podman network twice when you use <code>systemctl restart firewalld</code>.</p><div class="language-python3 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python3 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import dbus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from gi.repository import GLib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from dbus.mainloop.glib import DBusGMainLoop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import subprocess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import sys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># I&#x27;m a bit confused on the return values in the code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Not sure if they are needed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def reload_podman_network():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subprocess.run([&quot;podman&quot;,&quot;network&quot;,&quot;reload&quot;,&quot;--all&quot;],timeout=90)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # I&#x27;m not sure about this part</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stdout.write(&quot;podman network reload done\n&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stdout.flush()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except subprocess.TimeoutExpired as t:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stderr.write(f&quot;Podman reload failed due to Timeout {t}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except subprocess.CalledProcessError as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stderr.write(f&quot;Podman reload failed due to {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stderr.write(f&quot;Podman reload failed with an Unhandled Exception {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def signal_handler(*args, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if kwargs.get(&#x27;member&#x27;) == &quot;Reloaded&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reload_podman_network()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elif kwargs.get(&#x27;member&#x27;) == &quot;NameOwnerChanged&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reload_podman_network()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def signal_listener():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DBusGMainLoop(set_as_default=True)# Define the loop.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop = GLib.MainLoop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        system_bus = dbus.SystemBus()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Listens to systemctl restart firewalld with a filter added, will cause podman network to be reloaded twice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        system_bus.add_signal_receiver(signal_handler,dbus_interface=&#x27;org.freedesktop.DBus&#x27;,arg0=&#x27;org.fedoraproject.FirewallD1&#x27;,member_keyword=&#x27;member&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Listens to firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        system_bus.add_signal_receiver(signal_handler,dbus_interface=&#x27;org.fedoraproject.FirewallD1&#x27;,signal_name=&#x27;Reloaded&#x27;,member_keyword=&#x27;member&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop.run()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except KeyboardInterrupt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop.quit()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.exit(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop.quit()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.stderr.write(f&quot;Error occurred {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.exit(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signal_listener()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied">31) Podman run fails with <code>ERRO[0000] XDG_RUNTIME_DIR directory &quot;/run/user/0&quot; is not owned by the current user</code> or <code>Error: creating tmpdir: mkdir /run/user/1000: permission denied</code>.<a href="#31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied" class="hash-link" aria-label="Direct link to 31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied" title="Direct link to 31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied">​</a></h3><p>A failure is encountered when performing <code>podman run</code> with a warning <code>XDG_RUNTIME_DIR is pointing to a path which is not writable. Most likely podman will fail.</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-27">Symptom<a href="#symptom-27" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>A rootless container is being invoked with cgroup configuration as <code>cgroupv2</code> for user with missing or invalid <strong>systemd session</strong>.</p><p>Example cases</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># su user1 -c &#x27;podman images&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERRO[0000] XDG_RUNTIME_DIR directory &quot;/run/user/0&quot; is not owned by the current user</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># su - user1 -c &#x27;podman images&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating tmpdir: mkdir /run/user/1000: permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-28">Solution<a href="#solution-28" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Podman expects a valid login session for the <code>rootless+cgroupv2</code> use-case. Podman execution is expected to fail if the login session is not present. In most cases, podman will figure out a solution on its own but if <code>XDG_RUNTIME_DIR</code> is pointing to a path that is not writable execution will most likely fail. Typical scenarios of such cases are seen when users are trying to use Podman with <code>su - &lt;user&gt; -c &#x27;&lt;podman-command&gt;&#x27;</code>, or <code>sudo -l</code> and badly configured systemd session.</p><p>Alternatives:</p><ul><li><p>Execute Podman via <strong>systemd-run</strong> that will first start a systemd login session:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo systemd-run --machine=username@ --quiet --user --collect --pipe --wait podman run --rm docker.io/library/alpine echo hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Start an interactive shell in a systemd login session with the command <code>machinectl shell &lt;username&gt;@</code>
and then run Podman</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># machinectl shell username@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected to the local host. Press ^] three times within 1s to exit session.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm docker.io/library/alpine echo hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Start a new systemd login session by logging in with <code>ssh</code> i.e. <code>ssh &lt;username&gt;@localhost</code> and then run Podman.</p></li><li><p>Before invoking Podman command create a valid login session for your rootless user using <code>loginctl enable-linger &lt;username&gt;</code></p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-1270017777-port-already-bound">32) 127.0.0.1:7777 port already bound<a href="#32-1270017777-port-already-bound" class="hash-link" aria-label="Direct link to 32) 127.0.0.1:7777 port already bound" title="Direct link to 32) 127.0.0.1:7777 port already bound">​</a></h3><p>After deleting a VM on macOS, the initialization of subsequent VMs fails.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-28">Symptom<a href="#symptom-28" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>After deleting a client VM on macOS via <code>podman machine stop</code> &amp;&amp; <code>podman machine rm</code>, attempting to <code>podman machine init</code> a new client VM leads to an error with the 127.0.0.1:7777 port already bound.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-29">Solution<a href="#solution-29" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>You will need to remove the hanging gv-proxy process bound to the port in question. For example, if the port mentioned in the error message is 127.0.0.1:7777, you can use the command <code>kill -9 $(lsof -i:7777)</code> in order to identify and remove the hanging process which prevents you from starting a new VM on that default port.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-the-sshd-process-fails-to-run-inside-of-the-container">33) The sshd process fails to run inside of the container.<a href="#33-the-sshd-process-fails-to-run-inside-of-the-container" class="hash-link" aria-label="Direct link to 33) The sshd process fails to run inside of the container." title="Direct link to 33) The sshd process fails to run inside of the container.">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-29">Symptom<a href="#symptom-29" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>The sshd process running inside the container fails with the error
&quot;Error writing /proc/self/loginuid&quot;.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-30">Solution<a href="#solution-30" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h3><p>If the <code>/proc/self/loginuid</code> file is already initialized then the
<code>CAP_AUDIT_CONTROL</code> capability is required to override it.</p><p>This happens when running Podman from a user session since the
<code>/proc/self/loginuid</code> file is already initialized. The solution is to
run Podman from a system service, either using the Podman service, and
then using podman -remote to start the container or simply by running
something like <code>systemd-run podman run ...</code>. In this case the
container will only need <code>CAP_AUDIT_WRITE</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid">34) Container creates a file that is not owned by the user&#x27;s regular UID<a href="#34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid" class="hash-link" aria-label="Direct link to 34) Container creates a file that is not owned by the user&#x27;s regular UID" title="Direct link to 34) Container creates a file that is not owned by the user&#x27;s regular UID">​</a></h3><p>After running a container with rootless Podman, the non-root user sees a numerical UID and GID instead of a username and groupname.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-30">Symptom<a href="#symptom-30" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>When listing file permissions with <code>ls -l</code> on the host in a directory that was passed as <code>--volume /some/dir</code> to <code>podman run</code>,
the UID and GID are displayed rather than the corresponding username and groupname. The UID and GID numbers displayed are
from the user&#x27;s subordinate UID and GID ranges on the host system.</p><p>An example</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod 777 dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -v ./dir1:/dir1:Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             --user 2003:2003 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             docker.io/library/ubuntu bash -c &quot;touch /dir1/a; chmod 600 /dir1/a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -l dir1/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------. 1 102002 102002 0 Jan 19 19:35 dir1/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ less dir1/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">less: dir1/a: Permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-31">Solution<a href="#solution-31" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>If you want to read, chown, or remove such a file, enter a user
namespace. Instead of running commands such as <code>less dir1/a</code> or <code>rm dir1/a</code>, you
need to prepend the command-line with <code>podman unshare</code>, i.e.,
<code>podman unshare less dir1/a</code> or <code>podman unshare rm dir1/a</code>. To change the ownership
of the file <code>dir1/a</code> to your regular user&#x27;s UID and GID, run <code>podman unshare chown 0:0 dir1/a</code>.
A file having the ownership <code>0:0</code> in the user namespace is owned by the regular
user on the host. To use Bash features, such as variable expansion and
globbing, you need to wrap the command with <code>bash -c</code>, e.g.
<code>podman unshare bash -c &#x27;ls $HOME/dir1/a*&#x27;</code>.</p><p>Would it have been possible to run Podman in another way so that your regular
user would have become the owner of the file? Yes, you can use the option
<code>--userns keep-id:uid=$uid,gid=$gid</code> to change how UIDs and GIDs are mapped
between the container and the host. Let&#x27;s try it out.</p><p>In the example above <code>ls -l</code> shows the UID 102002 and GID 102002. Set shell variables</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid_from_ls=102002</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid_from_ls=102002</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Set shell variables to the lowest subordinate UID and GID</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ lowest_subuid=$(podman info --format &quot;{{ (index .Host.IDMappings.UIDMap 1).HostID }}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ lowest_subgid=$(podman info --format &quot;{{ (index .Host.IDMappings.GIDMap 1).HostID }}&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compute the UID and GID inside the container that map to the owner of the created file on the host.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid=$(( $uid_from_ls - $lowest_subuid + 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid=$(( $gid_from_ls - $lowest_subgid + 1))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(In the computation it was assumed that there is only one subuid range and one subgid range)</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo $uid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ echo $gid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2003</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The computation shows that the UID is <code>2003</code> and the GID is <code>2003</code> inside the container.
This comes as no surprise as this is what was specified before with <code>--user=2003:2003</code>,
but the same computation could be used whenever a username is specified
or the <code>--user</code> option is not used.</p><p>Run the container again but now with UIDs and GIDs mapped</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod 777 dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v ./dir1:/dir1:Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user $uid:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --userns keep-id:uid=$uid,gid=$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     docker.io/library/ubuntu bash -c &quot;touch /dir1/a; chmod 600 /dir1/a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ id -u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ id -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tester</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -l dir1/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-------. 1 tester tester 0 Jan 19 20:31 dir1/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example the <code>--user</code> option specified a rootless user in the container.
As the rootless user could also have been specified in the container image, e.g.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman image inspect --format &quot;user: {{.User}}&quot; IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user: hpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>the same problem could also occur even without specifying <code>--user</code>.</p><p>Another variant of the same problem could occur when using
<code>--user=root:root</code> (the default), but where the root user creates non-root owned files
in some way (e.g by creating them themselves, or switching the effective UID to
a rootless user and then creates files).</p><p>See also the troubleshooting tip:</p><p><a href="#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed"><em>Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;</em></a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35-passed-in-devices-or-files-cant-be-accessed-in-rootless-container-uidgid-mapping-problem">35) Passed-in devices or files can&#x27;t be accessed in rootless container (UID/GID mapping problem)<a href="#35-passed-in-devices-or-files-cant-be-accessed-in-rootless-container-uidgid-mapping-problem" class="hash-link" aria-label="Direct link to 35) Passed-in devices or files can&#x27;t be accessed in rootless container (UID/GID mapping problem)" title="Direct link to 35) Passed-in devices or files can&#x27;t be accessed in rootless container (UID/GID mapping problem)">​</a></h3><p>As a non-root user you have access rights to devices, files and directories that you
want to pass into a rootless container with <code>--device=...</code>, <code>--volume=...</code> or <code>--mount=..</code>.</p><p>Podman by default maps a non-root user inside a container to one of the user&#x27;s
subordinate UIDs and subordinate GIDs on the host. When the container user tries to access a
file, a &quot;Permission denied&quot; error could occur because the container user does not have the
permissions of the regular user of the host.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-31">Symptom<a href="#symptom-31" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><ul><li>Any access inside the container is rejected with &quot;Permission denied&quot;
for files, directories or devices passed in to the container
with <code>--device=..</code>,<code>--volume=..</code> or <code>--mount=..</code>, e.g.</li></ul><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod 700 dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -v ./dir1:/dir1:Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             --user 2003:2003 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             docker.io/library/ubuntu ls /dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls: cannot open directory &#x27;/dir1&#x27;: Permission denied</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-32">Solution<a href="#solution-32" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>We follow essentially the same solution as in the previous
troubleshooting tip:</p><p><a href="#34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid"><em>Container creates a file that is not owned by the user&#x27;s regular UID</em></a></p><p>but for this problem the container UID and GID can&#x27;t be as
easily computed by mere addition and subtraction.</p><p>In other words, it might be more challenging to find out the UID and
the GID inside the container that we want to map to the regular
user on the host.</p><p>If the <code>--user</code> option is used together with a numerical UID and GID
to specify a rootless user, we already know the answer.</p><p>If the <code>--user</code> option is used together with a username and groupname,
we could look up the UID and GID in the file <code>/etc/passwd</code> of the container.</p><p>If the container user is not set via <code>--user</code> but instead from the
container image, we could inspect the container image</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman image inspect --format &quot;user: {{.User}}&quot; IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user: hpc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and then look it up in <code>/etc/passwd</code> of the container.</p><p>If the problem occurs in a container that is started to run as root but later
switches to an effictive UID of a rootless user, it might be less
straightforward to find out the UID and the GID. Reading the
<code>Containerfile</code>, <code>Dockerfile</code> or the <code>/etc/passwd</code> could give a clue.</p><p>To run the container with the rootless container UID and GID mapped to the
user&#x27;s regular UID and GID on the host follow these steps:</p><p>Set the <code>uid</code> and <code>gid</code> shell variables in a Bash shell to the UID and GID
of the user that will be running inside the container, e.g.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid=2003</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid=2003</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and run</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir dir1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ echo hello &gt; dir1/file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod 700 dir1/file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v ./dir1:/dir1:Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user $uid:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --userns keep-id:uid=$uid,gid=$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  docker.io/library/alpine cat /dir1/file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See also the troubleshooting tip:</p><p><a href="#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed"><em>Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;</em></a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="36-images-in-the-additional-stores-can-be-deleted-even-if-there-are-containers-using-them">36) Images in the additional stores can be deleted even if there are containers using them<a href="#36-images-in-the-additional-stores-can-be-deleted-even-if-there-are-containers-using-them" class="hash-link" aria-label="Direct link to 36) Images in the additional stores can be deleted even if there are containers using them" title="Direct link to 36) Images in the additional stores can be deleted even if there are containers using them">​</a></h3><p>When an image in an additional store is used, it is not locked thus it
can be deleted even if there are containers using it.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-32">Symptom<a href="#symptom-32" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>WARN<!-- -->[0000]<!-- --> Can&#x27;t stat lower layer &quot;/var/lib/containers/storage/overlay/l/7HS76F2P5N73FDUKUQAOJA3WI5&quot; because it does not exist. Going through storage to recreate the missing symlinks.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-33">Solution<a href="#solution-33" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>It is the user responsibility to make sure images in an additional
store are not deleted while being used by containers in another
store.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="37-syncing-bugfixes-for-podman-remote-or-setups-using-podman-api">37) Syncing bugfixes for podman-remote or setups using Podman API<a href="#37-syncing-bugfixes-for-podman-remote-or-setups-using-podman-api" class="hash-link" aria-label="Direct link to 37) Syncing bugfixes for podman-remote or setups using Podman API" title="Direct link to 37) Syncing bugfixes for podman-remote or setups using Podman API">​</a></h3><p>After upgrading Podman to a newer version an issue with the earlier version of Podman still presents itself while using podman-remote.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-33">Symptom<a href="#symptom-33" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>While running podman remote commands with the most updated Podman, issues that were fixed in a prior version of Podman can arise either on the Podman client side or the Podman server side.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-34">Solution<a href="#solution-34" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>When upgrading Podman to a particular version for the required fixes, users often make the mistake of only upgrading the Podman client. However, suppose a setup uses <code>podman-remote</code> or uses a client that communicates with the Podman server on a remote machine via the REST API. In that case, it is required to upgrade both the Podman client and the Podman server running on the remote machine. Both the Podman client and server must be upgraded to the same version.</p><p>Example: If a particular bug was fixed in <code>v4.1.0</code> then the Podman client must have version <code>v4.1.0</code> as well the Podman server must have version <code>v4.1.0</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="38-unexpected-carriage-returns-are-outputted-on-the-terminal">38) Unexpected carriage returns are outputted on the terminal<a href="#38-unexpected-carriage-returns-are-outputted-on-the-terminal" class="hash-link" aria-label="Direct link to 38) Unexpected carriage returns are outputted on the terminal" title="Direct link to 38) Unexpected carriage returns are outputted on the terminal">​</a></h3><p>When using the <strong>--tty</strong> (<strong>-t</strong>) flag, unexpected carriage returns are outputted on the terminal.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-34">Symptom<a href="#symptom-34" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>The container program prints a newline (<code>\n</code>) but the terminal outputs a carriage return and a newline (<code>\r\n</code>).</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -t fedora echo abc | od -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000   a   b   c  \r  \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000005</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When run directly on the host, the result is as expected.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo abc | od -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000   a   b   c  \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000004</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Extra carriage returns can also shift the prompt to the right.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -t fedora sh -c &quot;echo 1; echo 2; echo 3&quot; | cat -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1^M$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2^M$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        3^M$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-35">Solution<a href="#solution-35" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Run Podman without the <strong>--tty</strong> (<strong>-t</strong>) flag.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm fedora echo abc | od -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000   a   b   c  \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000004</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <strong>--tty</strong> (<strong>-t</strong>) flag should only be used when the program requires user interaction in the termainal, for instance expecting
the user to type an answer to a question.</p><p>Where does the extra carriage return <code>\r</code> come from?</p><p>The extra <code>\r</code> is not outputted by Podman but by the terminal. In fact, a reconfiguration of the terminal can make the extra <code>\r</code> go away.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm -t fedora /bin/sh -c &quot;stty -onlcr &amp;&amp; echo abc&quot; | od -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000   a   b   c  \n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000004</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed">39) Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;<a href="#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed" class="hash-link" aria-label="Direct link to 39) Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;" title="Direct link to 39) Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;">​</a></h3><p>Podman 4.3.0 introduced the options <em>uid</em> and <em>gid</em> that can be given to <code>--userns keep-id</code> which are not recognized by older versions of Podman.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-35">Symptom<a href="#symptom-35" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>When using a Podman version older than 4.3.0, the options <em>uid</em> and <em>gid</em> are not recognized, and an &quot;unrecognized namespace mode&quot; error is raised.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user $uid:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --userns keep-id:uid=$uid,gid=$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     docker.io/library/ubuntu /bin/cat /proc/self/uid_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-36">Solution<a href="#solution-36" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>Use <strong>--uidmap</strong> and <strong>--gidmap</strong> options to describe the same UID and GID mapping.</p><p>Run</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ subuidSize=$(( $(podman info --format &quot;{{ range \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .Host.IDMappings.UIDMap }}+{{.Size }}{{end }}&quot; ) - 1 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ subgidSize=$(( $(podman info --format &quot;{{ range \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .Host.IDMappings.GIDMap }}+{{.Size }}{{end }}&quot; ) - 1 ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user $uid:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --uidmap 0:1:$uid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --uidmap $uid:0:1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --uidmap $(($uid+1)):$(($uid+1)):$(($subuidSize-$uid)) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gidmap 0:1:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gidmap $gid:0:1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gidmap $(($gid+1)):$(($gid+1)):$(($subgidSize-$gid)) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     docker.io/library/ubuntu /bin/cat /proc/self/uid_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         0          1       1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1000          0          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1001       1001      64536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which uses the same UID and GID mapping as when specifying
<code>--userns keep-id:uid=$uid,gid=$gid</code> with Podman 4.3.0 (or greater)</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ uid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gid=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ podman run --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user $uid:$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --userns keep-id:uid=$uid,gid=$gid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     docker.io/library/ubuntu /bin/cat /proc/self/uid_map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         0          1       1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1000          0          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1001       1001      64536</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Replace <code>/bin/cat /proc/self/uid_map</code> with
<code>/bin/cat /proc/self/gid_map</code> to show the GID mapping.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="40-podman-fails-to-find-expected-image-with-error-locating-pulled-image-image-not-known">40) Podman fails to find expected image with &quot;error locating pulled image&quot;, &quot;image not known&quot;<a href="#40-podman-fails-to-find-expected-image-with-error-locating-pulled-image-image-not-known" class="hash-link" aria-label="Direct link to 40) Podman fails to find expected image with &quot;error locating pulled image&quot;, &quot;image not known&quot;" title="Direct link to 40) Podman fails to find expected image with &quot;error locating pulled image&quot;, &quot;image not known&quot;">​</a></h3><p>When trying to do a Podman command that pulls an image from local storage or a remote repository,
an error is raised saying &quot;image not known&quot; or &quot;error locating pulled image&quot;. Even though the image
had been verified before the Podman command was invoked.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="symptom-36">Symptom<a href="#symptom-36" class="hash-link" aria-label="Direct link to Symptom" title="Direct link to Symptom">​</a></h4><p>After verifying that an image is in place either locally or on a remote repository, a Podman command
referencing that image will fail in a manner like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ls Containerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM registry.access.redhat.com/ubi8-minimal:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAINTAINER Podman Community</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USER root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># podman build .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STEP 1/2: FROM registry.access.redhat.com/ubi8-minimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Trying to pull registry.access.redhat.com/ubi8-minimal:latest...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Getting image source signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Checking if image destination supports signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying blob a6577091999b done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copying config abb1ba1bce done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing manifest to image destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Storing signatures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: error creating build container: error locating pulled image &quot;registry.access.redhat.com/ubi8-minimal:latest&quot; name in containers storage: registry.access.redhat.com/ubi8-minimal:latest: image not known</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="solution-37">Solution<a href="#solution-37" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h4><p>The general cause for this is a timing issue. To make Podman commands as
efficient as possible, read and write locks are only established for critical
sections within the code. When pulling an image from a repository, a copy of
that image is first written to local storage using a write lock. This lock is
released before the image is then acquired/read. If another process does a
harmful command such as <code>podman system prune --all</code> or <code>podman system reset</code>
or <code>podman rmi --all</code>, between the time the image is written and before the
first process can acquire it, this type of <code>image not known</code> error can arise.</p><p>The maintainers of Podman have considered heavier-duty locks to close this
timing window. However, the slowdown that all Podman commands would encounter
was not considered worth the cost of completely closing this small timing window.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/containers/website-new/docs/troubleshooting.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-list-of-common-issues-and-solutions-for-podman" class="table-of-contents__link toc-highlight">A list of common issues and solutions for Podman</a><ul><li><a href="#1-variety-of-issues---validate-version" class="table-of-contents__link toc-highlight">1) Variety of issues - Validate Version</a></li><li><a href="#2-cant-use-volume-mount-get-permission-denied" class="table-of-contents__link toc-highlight">2) Can&#39;t use volume mount, get permission denied</a></li><li><a href="#3-no-such-image-or-bare-keys-cannot-contain-" class="table-of-contents__link toc-highlight">3) No such image or Bare keys cannot contain &#39;:&#39;</a></li><li><a href="#4-http-server-gave-http-response-to-https-client" class="table-of-contents__link toc-highlight">4) http: server gave HTTP response to HTTPS client</a></li><li><a href="#5-rootless-containers-cannot-ping-hosts" class="table-of-contents__link toc-highlight">5) rootless containers cannot ping hosts</a></li><li><a href="#6-build-hangs-when-the-dockerfile-contains-the-useradd-command" class="table-of-contents__link toc-highlight">6) Build hangs when the Dockerfile contains the useradd command</a></li><li><a href="#7-permission-denied-when-running-podman-commands" class="table-of-contents__link toc-highlight">7) Permission denied when running Podman commands</a></li><li><a href="#8-permission-denied-when-running-systemd-within-a-podman-container" class="table-of-contents__link toc-highlight">8) Permission denied when running systemd within a Podman container</a></li><li><a href="#9-newuidmap-missing-when-running-rootless-podman-commands" class="table-of-contents__link toc-highlight">9) Newuidmap missing when running rootless Podman commands</a></li><li><a href="#10-rootless-setup-user-invalid-argument" class="table-of-contents__link toc-highlight">10) rootless setup user: invalid argument</a></li><li><a href="#11-changing-the-location-of-the-graphroot-leads-to-permission-denied" class="table-of-contents__link toc-highlight">11) Changing the location of the Graphroot leads to permission denied</a></li><li><a href="#12-anonymous-image-pull-fails-with-invalid-usernamepassword" class="table-of-contents__link toc-highlight">12) Anonymous image pull fails with &#39;invalid username/password&#39;</a></li><li><a href="#13-running-podman-inside-a-container-causes-container-crashes-and-inconsistent-states" class="table-of-contents__link toc-highlight">13) Running Podman inside a container causes container crashes and inconsistent states</a></li><li><a href="#14-rootless-podman-build-fails-eperm-on-nfs" class="table-of-contents__link toc-highlight">14) Rootless &#39;podman build&#39; fails EPERM on NFS:</a></li><li><a href="#15-rootless-podman-build-fails-when-using-overlayfs" class="table-of-contents__link toc-highlight">15) Rootless &#39;podman build&#39; fails when using OverlayFS:</a></li><li><a href="#16-rhel-7-and-centos-7-based-init-images-dont-work-with-cgroup-v2" class="table-of-contents__link toc-highlight">16) RHEL 7 and CentOS 7 based <code>init</code> images don&#39;t work with cgroup v2</a></li><li><a href="#17-rootless-containers-exit-once-the-user-session-exits" class="table-of-contents__link toc-highlight">17) rootless containers exit once the user session exits</a></li><li><a href="#18-podman-run-fails-with-bpf-create-permission-denied-error" class="table-of-contents__link toc-highlight">18) <code>podman run</code> fails with &quot;bpf create: permission denied error&quot;</a></li><li><a href="#19-error-creating-libpod-runtime-there-might-not-be-enough-ids-available-in-the-namespace" class="table-of-contents__link toc-highlight">19) error creating libpod runtime: there might not be enough IDs available in the namespace</a></li><li><a href="#20-passed-in-devices-or-files-cant-be-accessed-in-rootless-container" class="table-of-contents__link toc-highlight">20) Passed-in devices or files can&#39;t be accessed in rootless container</a></li><li><a href="#21-a-rootless-container-running-in-detached-mode-is-closed-at-logout" class="table-of-contents__link toc-highlight">21) A rootless container running in detached mode is closed at logout</a></li><li><a href="#22-containers-default-detach-keys-conflict-with-shell-history-navigation" class="table-of-contents__link toc-highlight">22) Containers default detach keys conflict with shell history navigation</a></li><li><a href="#23-container-with-exposed-ports-wont-run-in-a-pod" class="table-of-contents__link toc-highlight">23) Container with exposed ports won&#39;t run in a pod</a></li><li><a href="#24-podman-container-images-fail-with-fuse-device-not-found-when-run" class="table-of-contents__link toc-highlight">24) Podman container images fail with <code>fuse: device not found</code> when run</a></li><li><a href="#25-podman-run---rootfs-linktoreadonlydir-does-not-work" class="table-of-contents__link toc-highlight">25) podman run --rootfs link/to//read/only/dir does not work</a></li><li><a href="#26-running-containers-with-resource-limits-fails-with-a-permissions-error" class="table-of-contents__link toc-highlight">26) Running containers with resource limits fails with a permissions error</a></li><li><a href="#27-exec-container-process-binsh-exec-format-error-or-another-binary-than-binsh" class="table-of-contents__link toc-highlight">27) <code>exec container process &#39;/bin/sh&#39;: Exec format error</code> (or another binary than <code>bin/sh</code>)</a></li><li><a href="#28-error-failed-to-create-sshclient-connection-to-bastion-host-sshuserhost22runuserpodmanpodmansock-failed-ssh-handshake-failed-ssh-unable-to-authenticate-attempted-methods-none-publickey-no-supported-methods-remain" class="table-of-contents__link toc-highlight">28) <code>Error: failed to create sshClient: Connection to bastion host (ssh://user@host:22/run/user/.../podman/podman.sock) failed.: ssh: handshake failed: ssh: unable to authenticate, attempted methods [none publickey], no supported methods remain</code></a></li><li><a href="#29-rootless-cni-networking-fails-in-rhel-with-podman-v221-to-v301" class="table-of-contents__link toc-highlight">29) Rootless CNI networking fails in RHEL with Podman v2.2.1 to v3.0.1.</a></li><li><a href="#30-container-related-firewall-rules-are-lost-after-reloading-firewalld" class="table-of-contents__link toc-highlight">30) Container related firewall rules are lost after reloading firewalld</a></li><li><a href="#31-podman-run-fails-with-erro0000-xdg_runtime_dir-directory-runuser0-is-not-owned-by-the-current-user-or-error-creating-tmpdir-mkdir-runuser1000-permission-denied" class="table-of-contents__link toc-highlight">31) Podman run fails with <code>ERRO[0000] XDG_RUNTIME_DIR directory &quot;/run/user/0&quot; is not owned by the current user</code> or <code>Error: creating tmpdir: mkdir /run/user/1000: permission denied</code>.</a></li><li><a href="#32-1270017777-port-already-bound" class="table-of-contents__link toc-highlight">32) 127.0.0.1:7777 port already bound</a></li><li><a href="#33-the-sshd-process-fails-to-run-inside-of-the-container" class="table-of-contents__link toc-highlight">33) The sshd process fails to run inside of the container.</a></li><li><a href="#solution-30" class="table-of-contents__link toc-highlight">Solution</a></li><li><a href="#34-container-creates-a-file-that-is-not-owned-by-the-users-regular-uid" class="table-of-contents__link toc-highlight">34) Container creates a file that is not owned by the user&#39;s regular UID</a></li><li><a href="#35-passed-in-devices-or-files-cant-be-accessed-in-rootless-container-uidgid-mapping-problem" class="table-of-contents__link toc-highlight">35) Passed-in devices or files can&#39;t be accessed in rootless container (UID/GID mapping problem)</a></li><li><a href="#36-images-in-the-additional-stores-can-be-deleted-even-if-there-are-containers-using-them" class="table-of-contents__link toc-highlight">36) Images in the additional stores can be deleted even if there are containers using them</a></li><li><a href="#37-syncing-bugfixes-for-podman-remote-or-setups-using-podman-api" class="table-of-contents__link toc-highlight">37) Syncing bugfixes for podman-remote or setups using Podman API</a></li><li><a href="#38-unexpected-carriage-returns-are-outputted-on-the-terminal" class="table-of-contents__link toc-highlight">38) Unexpected carriage returns are outputted on the terminal</a></li><li><a href="#39-podman-run-fails-with-error-unrecognized-namespace-mode-keep-iduid1000gid1000-passed" class="table-of-contents__link toc-highlight">39) Podman run fails with &quot;Error: unrecognized namespace mode keep-id:uid=1000,gid=1000 passed&quot;</a></li><li><a href="#40-podman-fails-to-find-expected-image-with-error-locating-pulled-image-image-not-known" class="table-of-contents__link toc-highlight">40) Podman fails to find expected image with &quot;error locating pulled image&quot;, &quot;image not known&quot;</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.podman.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.podman.io/en/latest/Commands.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Podman CLI Commands<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.podman.io/en/latest/Commands.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Podman CLI Commands<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/x5GzFF6QH4" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.podman.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lists.podman.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing List<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/containers/podman" target="_blank" rel="noopener noreferrer" class="footer__link-item">Podman GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/containers/podman-desktop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Podman Desktop GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/containers/podman.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Podman Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Podman. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.473d615d.js"></script>
<script src="/assets/js/main.6b05015a.js"></script>
</body>
</html>